"use strict";
var ProjectRepository = require("../dataaccess/repository/ProjectRepository");
var BuildingRepository = require("../dataaccess/repository/BuildingRepository");
var UserService = require("./../../framework/services/UserService");
var ProjectAsset = require("../../framework/shared/projectasset");
var BuildingReport = require("../dataaccess/model/project/reports/BuildingReport");
var ThumbRuleReport = require("../dataaccess/model/project/reports/ThumbRuleReport");
var AuthInterceptor = require("../../framework/interceptor/auth.interceptor");
var EstimateReport = require("../dataaccess/model/project/reports/EstimateReport");
var ProjectReport = require("../dataaccess/model/project/reports/ProjectReport");
var ThumbRule = require("../dataaccess/model/project/building/ThumbRule");
var Estimate = require("../dataaccess/model/project/building/Estimate");
var RateAnalysisService = require("./RateAnalysisService");
var alasql = require("alasql");
var Constants = require("../shared/constants");
var config = require('config');
var log4js = require('log4js');
var logger = log4js.getLogger('Report Service');
var ReportService = (function () {
    function ReportService() {
        this.projectRepository = new ProjectRepository();
        this.buildingRepository = new BuildingRepository();
        this.APP_NAME = ProjectAsset.APP_NAME;
        this.authInterceptor = new AuthInterceptor();
        this.userService = new UserService();
        this.rateAnalysisService = new RateAnalysisService();
    }
    ReportService.prototype.getReport = function (projectId, reportType, rateUnit, areaType, user, callback) {
        var _this = this;
        logger.info('Report Service, getReport has been hit');
        var query = { _id: projectId };
        var populate = { path: 'buildings' };
        this.projectRepository.findAndPopulate(query, populate, function (error, result) {
            logger.info('Report Service, findAndPopulate has been hit');
            if (error) {
                callback(error, null);
            }
            else {
                var buildings = result[0].buildings;
                if (areaType === 'slabArea') {
                    var typeOfArea = 'totalSlabArea';
                }
                else if (areaType === 'saleableArea') {
                    typeOfArea = 'totalSaleableAreaOfUnit';
                }
                else if (areaType === 'carpetArea') {
                    typeOfArea = 'totalCarpetAreaOfUnit';
                }
                var totalArea = alasql('VALUE OF SELECT SUM(' + typeOfArea + ') FROM ?', [buildings]);
                var projectCostHeads = result[0].projectCostHeads;
                var projectReport = new ProjectReport();
                var buildingReport = new Array();
                _this.generateReportByCostHeads('buildingReport', buildings, areaType, rateUnit, buildingReport);
                projectReport.buildings = buildingReport;
                var commonAmenitiesReport = new Array();
                _this.generateReportForProjectCostHeads('commonAmenitiesReport', projectCostHeads, totalArea, areaType, rateUnit, commonAmenitiesReport);
                projectReport.commonAmenities = commonAmenitiesReport;
                callback(null, { data: projectReport, access_token: _this.authInterceptor.issueTokenWithUid(user) });
            }
        });
    };
    ReportService.prototype.generateReportByCostHeads = function (reportType, buildings, areaType, rateUnit, report) {
        for (var index = 0; index < buildings.length; index++) {
            var buildingReport = new BuildingReport;
            var thumbRuleReport = new ThumbRule();
            var estimatedReport = new Estimate();
            buildingReport.name = buildings[index].name;
            buildingReport._id = buildings[index]._id;
            if (areaType === 'slabArea') {
                if (rateUnit === 'sqmt') {
                    buildingReport.area = parseFloat((buildings[index].totalSlabArea * config.get('SqureMeter')).toFixed(2));
                }
                else {
                    buildingReport.area = parseFloat((buildings[index].totalSlabArea).toFixed(2));
                }
            }
            else {
                if (rateUnit === 'sqmt') {
                    buildingReport.area = parseFloat((buildings[index].totalSaleableAreaOfUnit * config.get('SqureMeter')).toFixed(2));
                }
                else {
                    buildingReport.area = parseFloat((buildings[index].totalSaleableAreaOfUnit).toFixed(2));
                }
            }
            var costHeadArray = buildings[index].costHeads;
            for (var costHeadIndex = 0; costHeadIndex < costHeadArray.length; costHeadIndex++) {
                if (costHeadArray[costHeadIndex].active === true) {
                    var thumbRule = new ThumbRuleReport();
                    var estimateReport = new EstimateReport();
                    thumbRule.name = costHeadArray[costHeadIndex].name;
                    estimateReport.name = costHeadArray[costHeadIndex].name;
                    thumbRule.rateAnalysisId = costHeadArray[costHeadIndex].rateAnalysisId;
                    estimateReport.rateAnalysisId = costHeadArray[costHeadIndex].rateAnalysisId;
                    if (areaType === 'slabArea') {
                        thumbRuleReport.area = buildings[index].totalSlabArea;
                        estimatedReport.area = buildings[index].totalSlabArea;
                        if (rateUnit === 'sqft') {
                            thumbRule.rate = parseFloat((costHeadArray[costHeadIndex].thumbRuleRate.slabArea.sqft).toFixed(2));
                        }
                        else {
                            thumbRule.rate = parseFloat((costHeadArray[costHeadIndex].thumbRuleRate.slabArea.sqmt).toFixed(2));
                            thumbRuleReport.area = parseFloat((buildings[index].totalSlabArea * config.get('SqureMeter')).toFixed(2));
                            estimatedReport.area = parseFloat((buildings[index].totalSlabArea * config.get('SqureMeter')).toFixed(2));
                        }
                    }
                    else {
                        thumbRuleReport.area = buildings[index].totalSaleableAreaOfUnit;
                        estimatedReport.area = buildings[index].totalSaleableAreaOfUnit;
                        if (rateUnit === 'sqft') {
                            thumbRule.rate = parseFloat((costHeadArray[costHeadIndex].thumbRuleRate.saleableArea.sqft).toFixed(2));
                        }
                        else {
                            thumbRule.rate = parseFloat((costHeadArray[costHeadIndex].thumbRuleRate.saleableArea.sqmt).toFixed(2));
                            thumbRuleReport.area = parseFloat((buildings[index].totalSaleableAreaOfUnit * config.get('SqureMeter')).toFixed(2));
                            estimatedReport.area = parseFloat((buildings[index].totalSaleableAreaOfUnit * config.get('SqureMeter')).toFixed(2));
                        }
                    }
                    var category = costHeadArray[costHeadIndex].categories;
                    if (category.length !== 0) {
                        for (var categoryKey in category) {
                            if (category[categoryKey].active) {
                                var workItem = category[categoryKey].workItems;
                                if (workItem.length !== 0) {
                                    for (var key in workItem) {
                                        if (workItem[key].active) {
                                            if (workItem[key].quantity.total !== null && workItem[key].rate.total !== null
                                                && workItem[key].quantity.total !== 0 && workItem[key].rate.total !== 0) {
                                                estimateReport.total = parseFloat((workItem[key].quantity.total * workItem[key].rate.total
                                                    + estimateReport.total).toFixed(2));
                                                estimateReport.rate = parseFloat((estimateReport.total / buildingReport.area).toFixed(2));
                                            }
                                            else {
                                            }
                                        }
                                    }
                                }
                                else {
                                }
                            }
                        }
                    }
                    estimatedReport.totalEstimatedCost = parseFloat((estimateReport.total + estimatedReport.totalEstimatedCost).toFixed(2));
                    estimatedReport.totalRate = parseFloat((estimatedReport.totalRate + estimateReport.rate).toFixed(2));
                    estimatedReport.estimatedCosts.push(estimateReport);
                    if (costHeadArray[costHeadIndex].budgetedCostAmount === 0 ||
                        costHeadArray[costHeadIndex].budgetedCostAmount === undefined) {
                        thumbRule.amount = parseFloat((thumbRuleReport.area * thumbRule.rate).toFixed(2));
                    }
                    else {
                        thumbRule.amount = parseFloat((costHeadArray[costHeadIndex].budgetedCostAmount).toFixed(2));
                    }
                    thumbRule.costHeadActive = costHeadArray[costHeadIndex].active;
                    thumbRuleReport.thumbRuleReports.push(thumbRule);
                    thumbRuleReport.totalRate = parseFloat((thumbRuleReport.totalRate + thumbRule.rate).toFixed(2));
                    thumbRuleReport.totalBudgetedCost = parseFloat((thumbRuleReport.totalBudgetedCost + thumbRule.amount).toFixed(2));
                    buildingReport.estimate = estimatedReport;
                    buildingReport.thumbRule = thumbRuleReport;
                }
            }
            report.push(buildingReport);
        }
    };
    ReportService.prototype.generateReportForProjectCostHeads = function (reportType, projectCostHeads, totalArea, areaType, rateUnit, report) {
        var projectCostHeadArray = projectCostHeads;
        var projectReport = new BuildingReport;
        for (var projectCostHeadIndex in projectCostHeadArray) {
            var thumbRule = new ThumbRule();
            var estimate = new Estimate();
            if (projectCostHeadArray[projectCostHeadIndex].active) {
                var thumbRuleReport = new ThumbRuleReport();
                var estimateReport = new EstimateReport();
                estimateReport.name = projectCostHeadArray[projectCostHeadIndex].name;
                estimateReport.rateAnalysisId = projectCostHeadArray[projectCostHeadIndex].rateAnalysisId;
                var categoryArray = projectCostHeadArray[projectCostHeadIndex].categories;
                for (var categoryIndex in categoryArray) {
                    if (categoryArray[categoryIndex].active) {
                        var workItemArray = categoryArray[categoryIndex].workItems;
                        if (workItemArray.length !== 0) {
                            for (var workItemIndex in workItemArray) {
                                if (workItemArray[workItemIndex].active) {
                                    if (workItemArray[workItemIndex].quantity.total !== null && workItemArray[workItemIndex].rate.total !== null
                                        && workItemArray[workItemIndex].quantity.total !== 0 && workItemArray[workItemIndex].rate.total !== 0) {
                                        estimateReport.total = parseFloat((workItemArray[workItemIndex].quantity.total *
                                            workItemArray[workItemIndex].rate.total + estimateReport.total).toFixed(2));
                                        estimateReport.rate = parseFloat((estimateReport.total / totalArea).toFixed(2));
                                    }
                                    else {
                                    }
                                }
                            }
                        }
                    }
                }
                estimate.totalEstimatedCost = parseFloat((estimateReport.total + estimate.totalEstimatedCost).toFixed(2));
                estimate.totalRate = parseFloat((estimate.totalRate + estimateReport.rate).toFixed(2));
                estimate.estimatedCosts.push(estimateReport);
                thumbRuleReport.name = projectCostHeadArray[projectCostHeadIndex].name;
                thumbRuleReport.rateAnalysisId = projectCostHeadArray[projectCostHeadIndex].rateAnalysisId;
                thumbRuleReport.amount = parseFloat((projectCostHeadArray[projectCostHeadIndex].budgetedCostAmount).toFixed(2));
                if (rateUnit === Constants.WORKITEM_UNIT) {
                    thumbRuleReport.rate = parseFloat((thumbRuleReport.amount / totalArea).toFixed(2));
                }
                else {
                    thumbRule.area = thumbRuleReport.amount * config.get(Constants.SQUARE_METER);
                    thumbRuleReport.rate = parseFloat((thumbRuleReport.amount / thumbRule.area).toFixed(2));
                }
                thumbRule.totalRate = parseFloat((thumbRule.totalRate + thumbRuleReport.rate).toFixed(2));
                thumbRule.totalBudgetedCost = parseFloat((thumbRule.totalBudgetedCost + thumbRuleReport.amount).toFixed(2));
                thumbRule.thumbRuleReports.push(thumbRuleReport);
                projectReport.thumbRule = thumbRule;
                projectReport.estimate = estimate;
            }
        }
        report.push(projectReport);
    };
    ReportService.prototype.getCostHeads = function (url, user, callback) {
        var _this = this;
        logger.info('Report Service, getCostHeads has been hit');
        this.rateAnalysisService.getCostHeads(url, user, function (error, result) {
            if (error) {
                console.log('error : ' + JSON.stringify(error));
                callback(error, null);
            }
            else {
                callback(null, { data: result, access_token: _this.authInterceptor.issueTokenWithUid(user) });
            }
        });
    };
    ReportService.prototype.getWorkItems = function (url, user, callback) {
        var _this = this;
        logger.info('Report Service, getWorkItems has been hit');
        this.rateAnalysisService.getWorkItems(url, user, function (error, result) {
            if (error) {
                console.log('error : ' + JSON.stringify(error));
                callback(error, null);
            }
            else {
                callback(null, { data: result, access_token: _this.authInterceptor.issueTokenWithUid(user) });
            }
        });
    };
    return ReportService;
}());
Object.seal(ReportService);
module.exports = ReportService;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC9hcHBsaWNhdGlvblByb2plY3Qvc2VydmljZXMvUmVwb3J0U2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsOEVBQWlGO0FBQ2pGLGdGQUFtRjtBQUVuRixvRUFBdUU7QUFDdkUsa0VBQXFFO0FBSXJFLG1GQUFzRjtBQUN0RixxRkFBd0Y7QUFDeEYsOEVBQWlGO0FBR2pGLG1GQUFzRjtBQUN0RixpRkFBb0Y7QUFFcEYsMEVBQTZFO0FBQzdFLHdFQUEyRTtBQUMzRSwyREFBOEQ7QUFFOUQsK0JBQWtDO0FBQ2xDLCtDQUFrRDtBQUNsRCxJQUFJLE1BQU0sR0FBRyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUM7QUFDL0IsSUFBSSxNQUFNLEdBQUcsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDO0FBQy9CLElBQUksTUFBTSxHQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztBQUU5QztJQVNFO1FBQ0UsSUFBSSxDQUFDLGlCQUFpQixHQUFHLElBQUksaUJBQWlCLEVBQUUsQ0FBQztRQUNqRCxJQUFJLENBQUMsa0JBQWtCLEdBQUcsSUFBSSxrQkFBa0IsRUFBRSxDQUFDO1FBQ25ELElBQUksQ0FBQyxRQUFRLEdBQUcsWUFBWSxDQUFDLFFBQVEsQ0FBQztRQUN0QyxJQUFJLENBQUMsZUFBZSxHQUFHLElBQUksZUFBZSxFQUFFLENBQUM7UUFDN0MsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLFdBQVcsRUFBRSxDQUFDO1FBQ3JDLElBQUksQ0FBQyxtQkFBbUIsR0FBRyxJQUFJLG1CQUFtQixFQUFFLENBQUM7SUFFdkQsQ0FBQztJQUVELGlDQUFTLEdBQVQsVUFBVyxTQUFlLEVBQUUsVUFBbUIsRUFBRSxRQUFpQixFQUFFLFFBQWlCLEVBQUcsSUFBVSxFQUN2RixRQUEyQztRQUR0RCxpQkFnQ0M7UUE3QkMsTUFBTSxDQUFDLElBQUksQ0FBQyx3Q0FBd0MsQ0FBQyxDQUFDO1FBQ3RELElBQUksS0FBSyxHQUFHLEVB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QVksR0FBWixVQUFjLEdBQVcsRUFBRyxJQUFVLEVBQUUsUUFBMkM7UUFBbkYsaUJBVUM7UUFUQyxNQUFNLENBQUMsSUFBSSxDQUFDLDJDQUEyQyxDQUFDLENBQUM7UUFDekQsSUFBSSxDQUFDLG1CQUFtQixDQUFDLFlBQVksQ0FBRSxHQUFHLEVBQUUsSUFBSSxFQUFDLFVBQUMsS0FBSyxFQUFFLE1BQU07WUFDN0QsRUFBRSxDQUFBLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztnQkFDVCxPQUFPLENBQUMsR0FBRyxDQUFDLFVBQVUsR0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7Z0JBQzlDLFFBQVEsQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLENBQUM7WUFDeEIsQ0FBQztZQUFDLElBQUksQ0FBQyxDQUFDO2dCQUNOLFFBQVEsQ0FBQyxJQUFJLEVBQUMsRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLFlBQVksRUFBRSxLQUFJLENBQUMsZUFBZSxDQUFDLGlCQUFpQixDQUFDLElBQUksQ0FBQyxFQUFDLENBQUMsQ0FBQztZQUM3RixDQUFDO1FBQ0gsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUgsb0JBQUM7QUFBRCxDQXRQQSxBQXNQQyxJQUFBO0FBRUQsTUFBTSxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsQ0FBQztBQUMzQixpQkFBUyxhQUFhLENBQUMiLCJmaWxlIjoiYXBwL2FwcGxpY2F0aW9uUHJvamVjdC9zZXJ2aWNlcy9SZXBvcnRTZXJ2aWNlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFByb2plY3RSZXBvc2l0b3J5ID0gcmVxdWlyZSgnLi4vZGF0YWFjY2Vzcy9yZXBvc2l0b3J5L1Byb2plY3RSZXBvc2l0b3J5Jyk7XHJcbmltcG9ydCBCdWlsZGluZ1JlcG9zaXRvcnkgPSByZXF1aXJlKCcuLi9kYXRhYWNjZXNzL3JlcG9zaXRvcnkvQnVpbGRpbmdSZXBvc2l0b3J5Jyk7XHJcbmltcG9ydCBNZXNzYWdlcyA9IHJlcXVpcmUoJy4uL3NoYXJlZC9tZXNzYWdlcycpO1xyXG5pbXBvcnQgVXNlclNlcnZpY2UgPSByZXF1aXJlKCcuLy4uLy4uL2ZyYW1ld29yay9zZXJ2aWNlcy9Vc2VyU2VydmljZScpO1xyXG5pbXBvcnQgUHJvamVjdEFzc2V0ID0gcmVxdWlyZSgnLi4vLi4vZnJhbWV3b3JrL3NoYXJlZC9wcm9qZWN0YXNzZXQnKTtcclxuaW1wb3J0IFVzZXIgPSByZXF1aXJlKCcuLi8uLi9mcmFtZXdvcmsvZGF0YWFjY2Vzcy9tb25nb29zZS91c2VyJyk7XHJcbmltcG9ydCBQcm9qZWN0ID0gcmVxdWlyZSgnLi4vZGF0YWFjY2Vzcy9tb25nb29zZS9Qcm9qZWN0Jyk7XHJcbmltcG9ydCBCdWlsZGluZyA9IHJlcXVpcmUoJy4uL2RhdGFhY2Nlc3MvbW9uZ29vc2UvQnVpbGRpbmcnKTtcclxuaW1wb3J0IEJ1aWxkaW5nUmVwb3J0ID0gcmVxdWlyZSgnLi4vZGF0YWFjY2Vzcy9tb2RlbC9wcm9qZWN0L3JlcG9ydHMvQnVpbGRpbmdSZXBvcnQnKTtcclxuaW1wb3J0IFRodW1iUnVsZVJlcG9ydCA9IHJlcXVpcmUoJy4uL2RhdGFhY2Nlc3MvbW9kZWwvcHJvamVjdC9yZXBvcnRzL1RodW1iUnVsZVJlcG9ydCcpO1xyXG5pbXBvcnQgQXV0aEludGVyY2VwdG9yID0gcmVxdWlyZSgnLi4vLi4vZnJhbWV3b3JrL2ludGVyY2VwdG9yL2F1dGguaW50ZXJjZXB0b3InKTtcclxuaW1wb3J0IENvc3RDb250cm9sbEV4Y2VwdGlvbiA9IHJlcXVpcmUoJy4uL2V4Y2VwdGlvbi9Db3N0Q29udHJvbGxFeGNlcHRpb24nKTtcclxuaW1wb3J0IENvc3RIZWFkID0gcmVxdWlyZSgnLi4vZGF0YWFjY2Vzcy9tb25nb29zZS9Db3N0SGVhZCcpO1xyXG5pbXBvcnQgRXN0aW1hdGVSZXBvcnQgPSByZXF1aXJlKCcuLi9kYXRhYWNjZXNzL21vZGVsL3Byb2plY3QvcmVwb3J0cy9Fc3RpbWF0ZVJlcG9ydCcpO1xyXG5pbXBvcnQgUHJvamVjdFJlcG9ydCA9IHJlcXVpcmUoJy4uL2RhdGFhY2Nlc3MvbW9kZWwvcHJvamVjdC9yZXBvcnRzL1Byb2plY3RSZXBvcnQnKTtcclxuaW1wb3J0IFdvcmtJdGVtID0gcmVxdWlyZSgnLi4vZGF0YWFjY2Vzcy9tb2RlbC9wcm9qZWN0L2J1aWxkaW5nL1dvcmtJdGVtJyk7XHJcbmltcG9ydCBUaHVtYlJ1bGUgPSByZXF1aXJlKCcuLi9kYXRhYWNjZXNzL21vZGVsL3Byb2plY3QvYnVpbGRpbmcvVGh1bWJSdWxlJyk7XHJcbmltcG9ydCBFc3RpbWF0ZSA9IHJlcXVpcmUoJy4uL2RhdGFhY2Nlc3MvbW9kZWwvcHJvamVjdC9idWlsZGluZy9Fc3RpbWF0ZScpO1xyXG5pbXBvcnQgUmF0ZUFuYWx5c2lzU2VydmljZSA9IHJlcXVpcmUoJy4vUmF0ZUFuYWx5c2lzU2VydmljZScpO1xyXG5pbXBvcnQgQ2F0ZWdvcnkgPSByZXF1aXJlKCcuLi9kYXRhYWNjZXNzL21vZGVsL3Byb2plY3QvYnVpbGRpbmcvQ2F0ZWdvcnknKTtcclxuaW1wb3J0IGFsYXNxbCA9IHJlcXVpcmUoJ2FsYXNxbCcpO1xyXG5pbXBvcnQgQ29uc3RhbnRzID0gcmVxdWlyZSgnLi4vc2hhcmVkL2NvbnN0YW50cycpO1xyXG5sZXQgY29uZmlnID0gcmVxdWlyZSgnY29uZmlnJyk7XHJcbnZhciBsb2c0anMgPSByZXF1aXJlKCdsb2c0anMnKTtcclxudmFyIGxvZ2dlcj1sb2c0anMuZ2V0TG9nZ2VyKCdSZXBvcnQgU2VydmljZScpO1xyXG5cclxuY2xhc3MgUmVwb3J0U2VydmljZSB7XHJcbiAgQVBQX05BTUU6IHN0cmluZztcclxuICBjb21wYW55X25hbWU6IHN0cmluZztcclxuICBwcml2YXRlIHByb2plY3RSZXBvc2l0b3J5OiBQcm9qZWN0UmVwb3NpdG9yeTtcclxuICBwcml2YXRlIGJ1aWxkaW5nUmVwb3NpdG9yeTogQnVpbGRpbmdSZXBvc2l0b3J5O1xyXG4gIHByaXZhdGUgYXV0aEludGVyY2VwdG9yOiBBdXRoSW50ZXJjZXB0b3I7XHJcbiAgcHJpdmF0ZSB1c2VyU2VydmljZSA6IFVzZXJTZXJ2aWNlO1xyXG4gIHByaXZhdGUgcmF0ZUFuYWx5c2lzU2VydmljZSA6IFJhdGVBbmFseXNpc1NlcnZpY2U7XHJcblxyXG4gIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgdGhpcy5wcm9qZWN0UmVwb3NpdG9yeSA9IG5ldyBQcm9qZWN0UmVwb3NpdG9yeSgpO1xyXG4gICAgdGhpcy5idWlsZGluZ1JlcG9zaXRvcnkgPSBuZXcgQnVpbGRpbmdSZXBvc2l0b3J5KCk7XHJcbiAgICB0aGlzLkFQUF9OQU1FID0gUHJvamVjdEFzc2V0LkFQUF9OQU1FO1xyXG4gICAgdGhpcy5hdXRoSW50ZXJjZXB0b3IgPSBuZXcgQXV0aEludGVyY2VwdG9yKCk7XHJcbiAgICB0aGlzLnVzZXJTZXJ2aWNlID0gbmV3IFVzZXJTZXJ2aWNlKCk7XHJcbiAgICB0aGlzLnJhdGVBbmFseXNpc1NlcnZpY2UgPSBuZXcgUmF0ZUFuYWx5c2lzU2VydmljZSgpO1xyXG4gICAgLy90aGlzLmNhdGVnb3J5RGV0YWlscyA9IG5ldyBjYXRlZ29yeURldGFpbHMoKTtcclxuICB9XHJcblxyXG4gIGdldFJlcG9ydCggcHJvamVjdElkIDogYW55LCByZXBvcnRUeXBlIDogc3RyaW5nLCByYXRlVW5pdCA6IHN0cmluZywgYXJlYVR5cGUgOiBzdHJpbmcs4oCC4oCCdXNlcjogVXNlcixcclxuICAgICAgICAgICAgIGNhbGxiYWNrOiAoZXJyb3I6IGFueSwgcmVzdWx0OiBhbnkpID0+IHZvaWQpIHtcclxuXHJcbiAgICBsb2dnZXIuaW5mbygnUmVwb3J0IFNlcnZpY2UsIGdldFJlcG9ydCBoYXMgYmVlbiBoaXQnKTtcclxuICAgIGxldCBxdWVyeSA9IHsgX2lkOiBwcm9qZWN0SWR9O1xyXG4gICAgbGV0IHBvcHVsYXRlID0ge3BhdGggOiAnYnVpbGRpbmdzJ307XHJcbiAgICB0aGlzLnByb2plY3RSZXBvc2l0b3J5LmZpbmRBbmRQb3B1bGF0ZShxdWVyeSwgcG9wdWxhdGUsIChlcnJvciwgcmVzdWx0KSA9PiB7XHJcbiAgICAgIGxvZ2dlci5pbmZvKCdSZXBvcnQgU2VydmljZSwgZmluZEFuZFBvcHVsYXRlIGhhcyBiZWVuIGhpdCcpO1xyXG4gICAgICBpZihlcnJvcikge1xyXG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBsZXQgYnVpbGRpbmdzID0gcmVzdWx0WzBdLmJ1aWxkaW5ncztcclxuICAgICAgICBpZiAoYXJlYVR5cGUgPT09ICdzbGFiQXJlYScpIHtcclxuICAgICAgICAgICAgdmFyIHR5cGVPZkFyZWEgPSAndG90YWxTbGFiQXJlYSc7XHJcbiAgICAgICAgICB9IGVsc2UgaWYgKGFyZWFUeXBlID09PSAnc2FsZWFibGVBcmVhJykge1xyXG4gICAgICAgICAgICB0eXBlT2ZBcmVhID0gJ3RvdGFsU2FsZWFibGVBcmVhT2ZVbml0JztcclxuICAgICAgICAgIH0gZWxzZSBpZiAoYXJlYVR5cGUgPT09ICdjYXJwZXRBcmVhJykge1xyXG4gICAgICAgICAgICB0eXBlT2ZBcmVhID0gJ3RvdGFsQ2FycGV0QXJlYU9mVW5pdCc7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgbGV0IHRvdGFsQXJlYSA9IGFsYXNxbCgnVkFMVUUgT0YgU0VMRUNUIFNVTSgnK3R5cGVPZkFyZWErJykgRlJPTSA/JyxbYnVpbGRpbmdzXSk7XHJcbiAgICAgICAgbGV0IHByb2plY3RDb3N0SGVhZHMgPSByZXN1bHRbMF0ucHJvamVjdENvc3RIZWFkcztcclxuICAgICAgICBsZXQgcHJvamVjdFJlcG9ydCA6IFByb2plY3RSZXBvcnQgPSBuZXcgUHJvamVjdFJlcG9ydCgpO1xyXG4gICAgICAgIGxldCBidWlsZGluZ1JlcG9ydCA6IEFycmF5PEJ1aWxkaW5nUmVwb3J0PiA9IG5ldyBBcnJheTxCdWlsZGluZ1JlcG9ydD4oKTtcclxuICAgICAgICB0aGlzLmdlbmVyYXRlUmVwb3J0QnlDb3N0SGVhZHMoICdidWlsZGluZ1JlcG9ydCcsIGJ1aWxkaW5ncywgYXJlYVR5cGUsIHJhdGVVbml0LCBidWlsZGluZ1JlcG9ydCk7XHJcbiAgICAgICAgcHJvamVjdFJlcG9ydC5idWlsZGluZ3MgPSBidWlsZGluZ1JlcG9ydDtcclxuICAgICAgICBsZXQgY29tbW9uQW1lbml0aWVzUmVwb3J0IDogQXJyYXk8QnVpbGRpbmdSZXBvcnQ+ID0gbmV3IEFycmF5PEJ1aWxkaW5nUmVwb3J0PigpO1xyXG4gICAgICAgIHRoaXMuZ2VuZXJhdGVSZXBvcnRGb3JQcm9qZWN0Q29zdEhlYWRzKCdjb21tb25BbWVuaXRpZXNSZXBvcnQnLHByb2plY3RDb3N0SGVhZHMgLHRvdGFsQXJlYSxcclxuICAgICAgICAgIGFyZWFUeXBlLCByYXRlVW5pdCwgY29tbW9uQW1lbml0aWVzUmVwb3J0KTtcclxuICAgICAgICBwcm9qZWN0UmVwb3J0LmNvbW1vbkFtZW5pdGllcyA9IGNvbW1vbkFtZW5pdGllc1JlcG9ydDtcclxuICAgICAgICBjYWxsYmFjayhudWxsLHsgZGF0YTogcHJvamVjdFJlcG9ydCwgYWNjZXNzX3Rva2VuOiB0aGlzLmF1dGhJbnRlcmNlcHRvci5pc3N1ZVRva2VuV2l0aFVpZCh1c2VyKX0pO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGdlbmVyYXRlUmVwb3J0QnlDb3N0SGVhZHMoIHJlcG9ydFR5cGUgOiBzdHJpbmcsIGJ1aWxkaW5nczogIEFycmF5PEJ1aWxkaW5nPiAsIGFyZWFUeXBlOiBzdHJpbmcsIHJhdGVVbml0OiBzdHJpbmcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwb3J0OiBBcnJheTxCdWlsZGluZ1JlcG9ydD4pIHtcclxuICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCBidWlsZGluZ3MubGVuZ3RoOyBpbmRleCsrKSB7XHJcbiAgICAgIGxldCBidWlsZGluZ1JlcG9ydCA9IG5ldyBCdWlsZGluZ1JlcG9ydDtcclxuICAgICAgbGV0IHRodW1iUnVsZVJlcG9ydDogVGh1bWJSdWxlID0gbmV3IFRodW1iUnVsZSgpO1xyXG4gICAgICBsZXQgZXN0aW1hdGVkUmVwb3J0OiBFc3RpbWF0ZSA9IG5ldyBFc3RpbWF0ZSgpO1xyXG4gICAgICBidWlsZGluZ1JlcG9ydC5uYW1lID0gYnVpbGRpbmdzW2luZGV4XS5uYW1lO1xyXG4gICAgICBidWlsZGluZ1JlcG9ydC5faWQgPSBidWlsZGluZ3NbaW5kZXhdLl9pZDtcclxuICAgICAgaWYgKGFyZWFUeXBlID09PSAnc2xhYkFyZWEnKSB7XHJcbiAgICAgICAgaWYgKHJhdGVVbml0ID09PSAnc3FtdCcpIHtcclxuICAgICAgICAgIGJ1aWxkaW5nUmVwb3J0LmFyZWEgPSBwYXJzZUZsb2F0KChidWlsZGluZ3NbaW5kZXhdLnRvdGFsU2xhYkFyZWEgKiBjb25maWcuZ2V0KCdTcXVyZU1ldGVyJykpLnRvRml4ZWQoMikpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBidWlsZGluZ1JlcG9ydC5hcmVhID0gcGFyc2VGbG9hdCgoYnVpbGRpbmdzW2luZGV4XS50b3RhbFNsYWJBcmVhKS50b0ZpeGVkKDIpKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgaWYgKHJhdGVVbml0ID09PSAnc3FtdCcpIHtcclxuICAgICAgICAgIGJ1aWxkaW5nUmVwb3J0LmFyZWEgPSBwYXJzZUZsb2F0KChidWlsZGluZ3NbaW5kZXhdLnRvdGFsU2FsZWFibGVBcmVhT2ZVbml0ICogY29uZmlnLmdldCgnU3F1cmVNZXRlcicpKS50b0ZpeGVkKDIpKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgYnVpbGRpbmdSZXBvcnQuYXJlYSA9IHBhcnNlRmxvYXQoKGJ1aWxkaW5nc1tpbmRleF0udG90YWxTYWxlYWJsZUFyZWFPZlVuaXQpLnRvRml4ZWQoMikpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICBsZXQgY29zdEhlYWRBcnJheTogYW55ID0gYnVpbGRpbmdzW2luZGV4XS5jb3N0SGVhZHM7XHJcbiAgICAgIGZvciAobGV0IGNvc3RIZWFkSW5kZXggPSAwOyBjb3N0SGVhZEluZGV4IDwgY29zdEhlYWRBcnJheS5sZW5ndGg7IGNvc3RIZWFkSW5kZXgrKykge1xyXG5cclxuICAgICAgICBpZiAoY29zdEhlYWRBcnJheVtjb3N0SGVhZEluZGV4XS5hY3RpdmUgPT09IHRydWUpIHtcclxuXHJcbiAgICAgICAgICBsZXQgdGh1bWJSdWxlOiBUaHVtYlJ1bGVSZXBvcnQgPSBuZXcgVGh1bWJSdWxlUmVwb3J0KCk7XHJcbiAgICAgICAgICBsZXQgZXN0aW1hdGVSZXBvcnQ6IEVzdGltYXRlUmVwb3J0ID0gbmV3IEVzdGltYXRlUmVwb3J0KCk7XHJcbiAgICAgICAgICB0aHVtYlJ1bGUubmFtZSA9IGNvc3RIZWFkQXJyYXlbY29zdEhlYWRJbmRleF0ubmFtZTtcclxuICAgICAgICAgIGVzdGltYXRlUmVwb3J0Lm5hbWUgPSBjb3N0SGVhZEFycmF5W2Nvc3RIZWFkSW5kZXhdLm5hbWU7XHJcbiAgICAgICAgICB0aHVtYlJ1bGUucmF0ZUFuYWx5c2lzSWQgPSBjb3N0SGVhZEFycmF5W2Nvc3RIZWFkSW5kZXhdLnJhdGVBbmFseXNpc0lkO1xyXG4gICAgICAgICAgZXN0aW1hdGVSZXBvcnQucmF0ZUFuYWx5c2lzSWQgPSBjb3N0SGVhZEFycmF5W2Nvc3RIZWFkSW5kZXhdLnJhdGVBbmFseXNpc0lkO1xyXG4gICAgICAgICAgaWYgKGFyZWFUeXBlID09PSAnc2xhYkFyZWEnKSB7XHJcbiAgICAgICAgICAgIHRodW1iUnVsZVJlcG9ydC5hcmVhID0gYnVpbGRpbmdzW2luZGV4XS50b3RhbFNsYWJBcmVhO1xyXG4gICAgICAgICAgICBlc3RpbWF0ZWRSZXBvcnQuYXJlYSA9IGJ1aWxkaW5nc1tpbmRleF0udG90YWxTbGFiQXJlYTtcclxuICAgICAgICAgICAgaWYgKHJhdGVVbml0ID09PSAnc3FmdCcpIHtcclxuICAgICAgICAgICAgICB0aHVtYlJ1bGUucmF0ZSA9IHBhcnNlRmxvYXQoKGNvc3RIZWFkQXJyYXlbY29zdEhlYWRJbmRleF0udGh1bWJSdWxlUmF0ZS5zbGFiQXJlYS5zcWZ0KS50b0ZpeGVkKDIpKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICB0aHVtYlJ1bGUucmF0ZSA9IHBhcnNlRmxvYXQoKGNvc3RIZWFkQXJyYXlbY29zdEhlYWRJbmRleF0udGh1bWJSdWxlUmF0ZS5zbGFiQXJlYS5zcW10KS50b0ZpeGVkKDIpKTtcclxuICAgICAgICAgICAgICB0aHVtYlJ1bGVSZXBvcnQuYXJlYSA9IHBhcnNlRmxvYXQoKGJ1aWxkaW5nc1tpbmRleF0udG90YWxTbGFiQXJlYSAqIGNvbmZpZy5nZXQoJ1NxdXJlTWV0ZXInKSkudG9GaXhlZCgyKSk7XHJcbiAgICAgICAgICAgICAgZXN0aW1hdGVkUmVwb3J0LmFyZWEgPSBwYXJzZUZsb2F0KChidWlsZGluZ3NbaW5kZXhdLnRvdGFsU2xhYkFyZWEgKiBjb25maWcuZ2V0KCdTcXVyZU1ldGVyJykpLnRvRml4ZWQoMikpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aHVtYlJ1bGVSZXBvcnQuYXJlYSA9IGJ1aWxkaW5nc1tpbmRleF0udG90YWxTYWxlYWJsZUFyZWFPZlVuaXQ7XHJcbiAgICAgICAgICAgIGVzdGltYXRlZFJlcG9ydC5hcmVhID0gYnVpbGRpbmdzW2luZGV4XS50b3RhbFNhbGVhYmxlQXJlYU9mVW5pdDtcclxuICAgICAgICAgICAgaWYgKHJhdGVVbml0ID09PSAnc3FmdCcpIHtcclxuICAgICAgICAgICAgICB0aHVtYlJ1bGUucmF0ZSA9IHBhcnNlRmxvYXQoKGNvc3RIZWFkQXJyYXlbY29zdEhlYWRJbmRleF0udGh1bWJSdWxlUmF0ZS5zYWxlYWJsZUFyZWEuc3FmdCkudG9GaXhlZCgyKSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgdGh1bWJSdWxlLnJhdGUgPSBwYXJzZUZsb2F0KChjb3N0SGVhZEFycmF5W2Nvc3RIZWFkSW5kZXhdLnRodW1iUnVsZVJhdGUuc2FsZWFibGVBcmVhLnNxbXQpLnRvRml4ZWQoMikpO1xyXG4gICAgICAgICAgICAgIHRodW1iUnVsZVJlcG9ydC5hcmVhID0gcGFyc2VGbG9hdCgoYnVpbGRpbmdzW2luZGV4XS50b3RhbFNhbGVhYmxlQXJlYU9mVW5pdCAqIGNvbmZpZy5nZXQoJ1NxdXJlTWV0ZXInKSkudG9GaXhlZCgyKSk7XHJcbiAgICAgICAgICAgICAgZXN0aW1hdGVkUmVwb3J0LmFyZWEgPSBwYXJzZUZsb2F0KChidWlsZGluZ3NbaW5kZXhdLnRvdGFsU2FsZWFibGVBcmVhT2ZVbml0ICogY29uZmlnLmdldCgnU3F1cmVNZXRlcicpKS50b0ZpeGVkKDIpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgbGV0IGNhdGVnb3J5OiBBcnJheTxDYXRlZ29yeT4gPSBjb3N0SGVhZEFycmF5W2Nvc3RIZWFkSW5kZXhdLmNhdGVnb3JpZXM7XHJcbiAgICAgICAgICBpZiAoY2F0ZWdvcnkubGVuZ3RoICE9PSAwKSB7XHJcblxyXG4gICAgICAgICAgICBmb3IgKGxldCBjYXRlZ29yeUtleSBpbiBjYXRlZ29yeSkge1xyXG4gICAgICAgICAgICAgIGlmIChjYXRlZ29yeVtjYXRlZ29yeUtleV0uYWN0aXZlKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgd29ya0l0ZW0gPSBjYXRlZ29yeVtjYXRlZ29yeUtleV0ud29ya0l0ZW1zO1xyXG4gICAgICAgICAgICAgICAgaWYgKHdvcmtJdGVtLmxlbmd0aCAhPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICBmb3IgKGxldCBrZXkgaW4gd29ya0l0ZW0pIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAod29ya0l0ZW1ba2V5XS5hY3RpdmUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgIGlmICh3b3JrSXRlbVtrZXldLnF1YW50aXR5LnRvdGFsICE9PSBudWxsICYmIHdvcmtJdGVtW2tleV0ucmF0ZS50b3RhbCAhPT0gbnVsbFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAmJiB3b3JrSXRlbVtrZXldLnF1YW50aXR5LnRvdGFsICE9PSAwICYmIHdvcmtJdGVtW2tleV0ucmF0ZS50b3RhbCAhPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBlc3RpbWF0ZVJlcG9ydC50b3RhbCA9IHBhcnNlRmxvYXQoKHdvcmtJdGVtW2tleV0ucXVhbnRpdHkudG90YWwgKiB3b3JrSXRlbVtrZXldLnJhdGUudG90YWxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICArIGVzdGltYXRlUmVwb3J0LnRvdGFsKS50b0ZpeGVkKDIpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZXN0aW1hdGVSZXBvcnQucmF0ZSA9IHBhcnNlRmxvYXQoKGVzdGltYXRlUmVwb3J0LnRvdGFsIC8gYnVpbGRpbmdSZXBvcnQuYXJlYSkudG9GaXhlZCgyKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvKmVzdGltYXRlUmVwb3J0LnRvdGFsID0gMC4wO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXN0aW1hdGVSZXBvcnQucmF0ZSA9IDAuMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOyovXHJcbiAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAvKmVzdGltYXRlUmVwb3J0LnRvdGFsID0gMC4wO1xyXG4gICAgICAgICAgICAgICAgICAgICAgZXN0aW1hdGVSZXBvcnQucmF0ZSA9IDAuMDtcclxuICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOyovXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgZXN0aW1hdGVkUmVwb3J0LnRvdGFsRXN0aW1hdGVkQ29zdCA9IHBhcnNlRmxvYXQoKGVzdGltYXRlUmVwb3J0LnRvdGFsICsgZXN0aW1hdGVkUmVwb3J0LnRvdGFsRXN0aW1hdGVkQ29zdCkudG9GaXhlZCgyKSk7XHJcbiAgICAgICAgICBlc3RpbWF0ZWRSZXBvcnQudG90YWxSYXRlID0gcGFyc2VGbG9hdCgoZXN0aW1hdGVkUmVwb3J0LnRvdGFsUmF0ZSArIGVzdGltYXRlUmVwb3J0LnJhdGUpLnRvRml4ZWQoMikpO1xyXG4gICAgICAgICAgZXN0aW1hdGVkUmVwb3J0LmVzdGltYXRlZENvc3RzLnB1c2goZXN0aW1hdGVSZXBvcnQpO1xyXG4gICAgICAgICAgaWYgKGNvc3RIZWFkQXJyYXlbY29zdEhlYWRJbmRleF0uYnVkZ2V0ZWRDb3N0QW1vdW50ID09PSAwIHx8XHJcbiAgICAgICAgICAgIGNvc3RIZWFkQXJyYXlbY29zdEhlYWRJbmRleF0uYnVkZ2V0ZWRDb3N0QW1vdW50ID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgdGh1bWJSdWxlLmFtb3VudCA9IHBhcnNlRmxvYXQoKHRodW1iUnVsZVJlcG9ydC5hcmVhICogdGh1bWJSdWxlLnJhdGUpLnRvRml4ZWQoMikpO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGh1bWJSdWxlLmFtb3VudCA9IHBhcnNlRmxvYXQoKGNvc3RIZWFkQXJyYXlbY29zdEhlYWRJbmRleF0uYnVkZ2V0ZWRDb3N0QW1vdW50KS50b0ZpeGVkKDIpKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIHRodW1iUnVsZS5jb3N0SGVhZEFjdGl2ZSA9IGNvc3RIZWFkQXJyYXlbY29zdEhlYWRJbmRleF0uYWN0aXZlO1xyXG4gICAgICAgICAgdGh1bWJSdWxlUmVwb3J0LnRodW1iUnVsZVJlcG9ydHMucHVzaCh0aHVtYlJ1bGUpO1xyXG4gICAgICAgICAgdGh1bWJSdWxlUmVwb3J0LnRvdGFsUmF0ZSA9IHBhcnNlRmxvYXQoKHRodW1iUnVsZVJlcG9ydC50b3RhbFJhdGUgKyB0aHVtYlJ1bGUucmF0ZSkudG9GaXhlZCgyKSk7XHJcbiAgICAgICAgICB0aHVtYlJ1bGVSZXBvcnQudG90YWxCdWRnZXRlZENvc3QgPSBwYXJzZUZsb2F0KCh0aHVtYlJ1bGVSZXBvcnQudG90YWxCdWRnZXRlZENvc3QgKyB0aHVtYlJ1bGUuYW1vdW50KS50b0ZpeGVkKDIpKTtcclxuICAgICAgICAgIGJ1aWxkaW5nUmVwb3J0LmVzdGltYXRlID0gZXN0aW1hdGVkUmVwb3J0O1xyXG4gICAgICAgICAgYnVpbGRpbmdSZXBvcnQudGh1bWJSdWxlID0gdGh1bWJSdWxlUmVwb3J0O1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICByZXBvcnQucHVzaChidWlsZGluZ1JlcG9ydCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuXHJcbmdlbmVyYXRlUmVwb3J0Rm9yUHJvamVjdENvc3RIZWFkcyggcmVwb3J0VHlwZSA6IHN0cmluZywgcHJvamVjdENvc3RIZWFkczogIEFycmF5PENvc3RIZWFkPiwgdG90YWxBcmVhOiBudW1iZXIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJlYVR5cGU6IHN0cmluZywgcmF0ZVVuaXQ6IHN0cmluZywgcmVwb3J0OiBBcnJheTxCdWlsZGluZ1JlcG9ydD4pIHtcclxuXHJcbiAgICAgIGxldCBwcm9qZWN0Q29zdEhlYWRBcnJheTogQXJyYXk8Q29zdEhlYWQ+ID0gcHJvamVjdENvc3RIZWFkcztcclxuICAgICAgbGV0IHByb2plY3RSZXBvcnQgPSBuZXcgQnVpbGRpbmdSZXBvcnQ7XHJcbiAgICAgICBmb3IgKGxldCBwcm9qZWN0Q29zdEhlYWRJbmRleCBpbiBwcm9qZWN0Q29zdEhlYWRBcnJheSkge1xyXG5cclxuICAgICAgICAgbGV0IHRodW1iUnVsZTogVGh1bWJSdWxlID0gbmV3IFRodW1iUnVsZSgpO1xyXG4gICAgICAgICBsZXQgZXN0aW1hdGUgOiBFc3RpbWF0ZSA9IG5ldyBFc3RpbWF0ZSgpO1xyXG5cclxuICAgICAgICAgaWYgKHByb2plY3RDb3N0SGVhZEFycmF5W3Byb2plY3RDb3N0SGVhZEluZGV4XS5hY3RpdmUpIHtcclxuXHJcbiAgICAgICAgICBsZXQgdGh1bWJSdWxlUmVwb3J0OiBUaHVtYlJ1bGVSZXBvcnQgPSBuZXcgVGh1bWJSdWxlUmVwb3J0KCk7XHJcbiAgICAgICAgICBsZXQgZXN0aW1hdGVSZXBvcnQ6IEVzdGltYXRlUmVwb3J0ID0gbmV3IEVzdGltYXRlUmVwb3J0KCk7XHJcblxyXG4gICAgICAgICAgIGVzdGltYXRlUmVwb3J0Lm5hbWUgPSBwcm9qZWN0Q29zdEhlYWRBcnJheVtwcm9qZWN0Q29zdEhlYWRJbmRleF0ubmFtZTtcclxuICAgICAgICAgICBlc3RpbWF0ZVJlcG9ydC5yYXRlQW5hbHlzaXNJZCA9IHByb2plY3RDb3N0SGVhZEFycmF5W3Byb2plY3RDb3N0SGVhZEluZGV4XS5yYXRlQW5hbHlzaXNJZDtcclxuXHJcbiAgICAgICAgICBsZXQgY2F0ZWdvcnlBcnJheSA6IEFycmF5PENhdGVnb3J5PiA9IHByb2plY3RDb3N0SGVhZEFycmF5W3Byb2plY3RDb3N0SGVhZEluZGV4XS5jYXRlZ29yaWVzO1xyXG4gICAgICAgICAgZm9yIChsZXQgY2F0ZWdvcnlJbmRleCBpbiBjYXRlZ29yeUFycmF5KSB7XHJcbiAgICAgICAgICAgIGlmIChjYXRlZ29yeUFycmF5W2NhdGVnb3J5SW5kZXhdLmFjdGl2ZSkge1xyXG4gICAgICAgICAgICAgIGxldCB3b3JrSXRlbUFycmF5ID0gY2F0ZWdvcnlBcnJheVtjYXRlZ29yeUluZGV4XS53b3JrSXRlbXM7XHJcbiAgICAgICAgICAgICAgaWYgKHdvcmtJdGVtQXJyYXkubGVuZ3RoICE9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICBmb3IgKGxldCB3b3JrSXRlbUluZGV4IGluIHdvcmtJdGVtQXJyYXkpIHtcclxuICAgICAgICAgICAgICAgICAgaWYgKHdvcmtJdGVtQXJyYXlbd29ya0l0ZW1JbmRleF0uYWN0aXZlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHdvcmtJdGVtQXJyYXlbd29ya0l0ZW1JbmRleF0ucXVhbnRpdHkudG90YWwgIT09IG51bGwgJiYgd29ya0l0ZW1BcnJheVt3b3JrSXRlbUluZGV4XS5yYXRlLnRvdGFsICE9PSBudWxsXHJcbiAgICAgICAgICAgICAgICAgICAgICAmJiB3b3JrSXRlbUFycmF5W3dvcmtJdGVtSW5kZXhdLnF1YW50aXR5LnRvdGFsICE9PSAwICYmIHdvcmtJdGVtQXJyYXlbd29ya0l0ZW1JbmRleF0ucmF0ZS50b3RhbCAhPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgZXN0aW1hdGVSZXBvcnQudG90YWwgPSBwYXJzZUZsb2F0KCh3b3JrSXRlbUFycmF5W3dvcmtJdGVtSW5kZXhdLnF1YW50aXR5LnRvdGFsICpcclxuICAgICAgICAgICAgICAgICAgICAgICAgd29ya0l0ZW1BcnJheVt3b3JrSXRlbUluZGV4XS5yYXRlLnRvdGFsICsgZXN0aW1hdGVSZXBvcnQudG90YWwpLnRvRml4ZWQoMikpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgZXN0aW1hdGVSZXBvcnQucmF0ZSA9IHBhcnNlRmxvYXQoKGVzdGltYXRlUmVwb3J0LnRvdGFsIC8gdG90YWxBcmVhKS50b0ZpeGVkKDIpKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgLyogIGVzdGltYXRlUmVwb3J0LnRvdGFsID0gMC4wO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBlc3RpbWF0ZVJlcG9ydC5yYXRlID0gMC4wO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhazsqL1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgZXN0aW1hdGUudG90YWxFc3RpbWF0ZWRDb3N0ID0gcGFyc2VGbG9hdCgoZXN0aW1hdGVSZXBvcnQudG90YWwgKyBlc3RpbWF0ZS50b3RhbEVzdGltYXRlZENvc3QpLnRvRml4ZWQoMikpO1xyXG4gICAgICAgICAgZXN0aW1hdGUudG90YWxSYXRlID0gcGFyc2VGbG9hdCgoZXN0aW1hdGUudG90YWxSYXRlICsgZXN0aW1hdGVSZXBvcnQucmF0ZSkudG9GaXhlZCgyKSk7XHJcbiAgICAgICAgICBlc3RpbWF0ZS5lc3RpbWF0ZWRDb3N0cy5wdXNoKGVzdGltYXRlUmVwb3J0KTtcclxuXHJcbiAgICAgICAgICAgdGh1bWJSdWxlUmVwb3J0Lm5hbWUgPSBwcm9qZWN0Q29zdEhlYWRBcnJheVtwcm9qZWN0Q29zdEhlYWRJbmRleF0ubmFtZTtcclxuICAgICAgICAgICB0aHVtYlJ1bGVSZXBvcnQucmF0ZUFuYWx5c2lzSWQgPSBwcm9qZWN0Q29zdEhlYWRBcnJheVtwcm9qZWN0Q29zdEhlYWRJbmRleF0ucmF0ZUFuYWx5c2lzSWQ7XHJcbiAgICAgICAgICAgdGh1bWJSdWxlUmVwb3J0LmFtb3VudCA9IHBhcnNlRmxvYXQoKHByb2plY3RDb3N0SGVhZEFycmF5W3Byb2plY3RDb3N0SGVhZEluZGV4XS5idWRnZXRlZENvc3RBbW91bnQpLnRvRml4ZWQoMikpO1xyXG5cclxuICAgICAgICAgICAgaWYgKHJhdGVVbml0ID09PSBDb25zdGFudHMuV09SS0lURU1fVU5JVCkge1xyXG4gICAgICAgICAgICAgIHRodW1iUnVsZVJlcG9ydC5yYXRlID0gIHBhcnNlRmxvYXQoKHRodW1iUnVsZVJlcG9ydC5hbW91bnQvdG90YWxBcmVhKS50b0ZpeGVkKDIpKTtcclxuICAgICAgICAgICAgfSBlbHNlICB7XHJcbiAgICAgICAgICAgICAgdGh1bWJSdWxlLmFyZWEgPSB0aHVtYlJ1bGVSZXBvcnQuYW1vdW50ICogY29uZmlnLmdldChDb25zdGFudHMuU1FVQVJFX01FVEVSKTtcclxuICAgICAgICAgICAgICB0aHVtYlJ1bGVSZXBvcnQucmF0ZSA9IHBhcnNlRmxvYXQoKHRodW1iUnVsZVJlcG9ydC5hbW91bnQvdGh1bWJSdWxlLmFyZWEpLnRvRml4ZWQoMikpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB0aHVtYlJ1bGUudG90YWxSYXRlID0gcGFyc2VGbG9hdCgodGh1bWJSdWxlLnRvdGFsUmF0ZSArIHRodW1iUnVsZVJlcG9ydC5yYXRlKS50b0ZpeGVkKDIpKTtcclxuICAgICAgICAgIHRodW1iUnVsZS50b3RhbEJ1ZGdldGVkQ29zdCA9IHBhcnNlRmxvYXQoKHRodW1iUnVsZS50b3RhbEJ1ZGdldGVkQ29zdCArIHRodW1iUnVsZVJlcG9ydC5hbW91bnQpLnRvRml4ZWQoMikpO1xyXG4gICAgICAgICAgdGh1bWJSdWxlLnRodW1iUnVsZVJlcG9ydHMucHVzaCh0aHVtYlJ1bGVSZXBvcnQpO1xyXG4gICAgICAgICAgcHJvamVjdFJlcG9ydC50aHVtYlJ1bGUgPSB0aHVtYlJ1bGU7XHJcbiAgICAgICAgICBwcm9qZWN0UmVwb3J0LmVzdGltYXRlID0gZXN0aW1hdGU7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIHJlcG9ydC5wdXNoKHByb2plY3RSZXBvcnQpO1xyXG4gIH1cclxuXHJcbiAgZ2V0Q29zdEhlYWRzKCAgdXJsOiBzdHJpbmcgLCB1c2VyOiBVc2VyLGNhbGxiYWNrOiAoZXJyb3I6IGFueSwgcmVzdWx0OiBhbnkpID0+IHZvaWQpIHtcclxuICAgIGxvZ2dlci5pbmZvKCdSZXBvcnQgU2VydmljZSwgZ2V0Q29zdEhlYWRzIGhhcyBiZWVuIGhpdCcpO1xyXG4gICAgdGhpcy5yYXRlQW5hbHlzaXNTZXJ2aWNlLmdldENvc3RIZWFkcyggdXJsLCB1c2VyLChlcnJvciwgcmVzdWx0KSA9PiB7XHJcbiAgICAgIGlmKGVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ2Vycm9yIDogJytKU09OLnN0cmluZ2lmeShlcnJvcikpO1xyXG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBjYWxsYmFjayhudWxsLHsgZGF0YTogcmVzdWx0LCBhY2Nlc3NfdG9rZW46IHRoaXMuYXV0aEludGVyY2VwdG9yLmlzc3VlVG9rZW5XaXRoVWlkKHVzZXIpfSk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgZ2V0V29ya0l0ZW1zKCB1cmw6IHN0cmluZyAsIHVzZXI6IFVzZXIsIGNhbGxiYWNrOiAoZXJyb3I6IGFueSwgcmVzdWx0OiBhbnkpID0+IHZvaWQpIHtcclxuICAgIGxvZ2dlci5pbmZvKCdSZXBvcnQgU2VydmljZSwgZ2V0V29ya0l0ZW1zIGhhcyBiZWVuIGhpdCcpO1xyXG4gICAgdGhpcy5yYXRlQW5hbHlzaXNTZXJ2aWNlLmdldFdvcmtJdGVtcyggdXJsLCB1c2VyLChlcnJvciwgcmVzdWx0KSA9PiB7XHJcbiAgICAgIGlmKGVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ2Vycm9yIDogJytKU09OLnN0cmluZ2lmeShlcnJvcikpO1xyXG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBjYWxsYmFjayhudWxsLHsgZGF0YTogcmVzdWx0LCBhY2Nlc3NfdG9rZW46IHRoaXMuYXV0aEludGVyY2VwdG9yLmlzc3VlVG9rZW5XaXRoVWlkKHVzZXIpfSk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbn1cclxuXHJcbk9iamVjdC5zZWFsKFJlcG9ydFNlcnZpY2UpO1xyXG5leHBvcnQgPSBSZXBvcnRTZXJ2aWNlO1xyXG5cclxuIl19
