"use strict";
var ProjectRepository = require("../dataaccess/repository/ProjectRepository");
var BuildingRepository = require("../dataaccess/repository/BuildingRepository");
var UserService = require("./../../framework/services/UserService");
var ProjectAsset = require("../../framework/shared/projectasset");
var BuildingReport = require("../dataaccess/model/project/reports/BuildingReport");
var ThumbRuleReport = require("../dataaccess/model/project/reports/ThumbRuleReport");
var AuthInterceptor = require("../../framework/interceptor/auth.interceptor");
var EstimateReport = require("../dataaccess/model/project/reports/EstimateReport");
var ProjectReport = require("../dataaccess/model/project/reports/ProjectReport");
var ThumbRule = require("../dataaccess/model/project/building/ThumbRule");
var Estimate = require("../dataaccess/model/project/building/Estimate");
var RateAnalysisService = require("./RateAnalysisService");
var alasql = require("alasql");
var Constants = require("../shared/constants");
var config = require('config');
var log4js = require('log4js');
var logger = log4js.getLogger('Report Service');
var ReportService = (function () {
    function ReportService() {
        this.projectRepository = new ProjectRepository();
        this.buildingRepository = new BuildingRepository();
        this.APP_NAME = ProjectAsset.APP_NAME;
        this.authInterceptor = new AuthInterceptor();
        this.userService = new UserService();
        this.rateAnalysisService = new RateAnalysisService();
    }
    ReportService.prototype.getReport = function (projectId, reportType, rateUnit, areaType, user, callback) {
        var _this = this;
        logger.info('Report Service, getReport has been hit');
        var query = { _id: projectId };
        var populate = { path: 'buildings' };
        this.projectRepository.findAndPopulate(query, populate, function (error, result) {
            logger.info('Report Service, findAndPopulate has been hit');
            if (error) {
                callback(error, null);
            }
            else {
                var buildings = result[0].buildings;
                if (areaType === Constants.SLAB_AREA) {
                    var typeOfArea = Constants.TOTAL_SLAB_AREA;
                }
                else if (areaType === Constants.SALEABLE_AREA) {
                    typeOfArea = Constants.TOTAL_SALEABLE_AREA;
                }
                else if (areaType === Constants.CARPET_AREA) {
                    typeOfArea = Constants.TOTAL_CARPET_AREA;
                }
                var totalArea = alasql('VALUE OF SELECT SUM(' + typeOfArea + ') FROM ?', [buildings]);
                var projectCostHeads = result[0].projectCostHeads;
                var projectReport = new ProjectReport();
                var buildingReport = new Array();
                _this.generateReportByCostHeads('buildingReport', buildings, areaType, rateUnit, buildingReport);
                projectReport.buildings = buildingReport;
                var commonAmenitiesReport = new Array();
                _this.generateReportForProjectCostHeads('commonAmenitiesReport', projectCostHeads, totalArea, areaType, rateUnit, commonAmenitiesReport);
                projectReport.commonAmenities = commonAmenitiesReport;
                callback(null, { data: projectReport, access_token: _this.authInterceptor.issueTokenWithUid(user) });
            }
        });
    };
    ReportService.prototype.generateReportByCostHeads = function (reportType, buildings, areaType, rateUnit, report) {
        for (var _i = 0, buildings_1 = buildings; _i < buildings_1.length; _i++) {
            var building = buildings_1[_i];
            var buildingAreaType = void 0;
            var reportUnitType = void 0;
            if (areaType === 'slabArea') {
                buildingAreaType = 'totalSlabArea';
            }
            else if (areaType === 'saleableArea') {
                buildingAreaType = 'totalSaleableAreaOfUnit';
            }
            else if (areaType === 'carpetArea') {
                buildingAreaType = 'totalCarpetAreaOfUnit';
            }
            var buildingReport = new BuildingReport;
            buildingReport.name = building.name;
            buildingReport._id = building._id;
            buildingReport.area = building[buildingAreaType];
            var thumbRule = new ThumbRule();
            var estimate = new Estimate();
            var thumbRuleReports = new Array();
            var estimatedReports = new Array();
            this.getThumbRuleAndEstimatedReport(building, buildingReport, thumbRuleReports, estimatedReports, rateUnit);
            var totalRates = alasql('SELECT SUM(amount) AS totalAmount, SUM(rate) AS totalRate FROM ?', [thumbRuleReports]);
            thumbRule.totalRate = totalRates[0].totalRate;
            if (rateUnit === Constants.SQUREMETER_UNIT) {
                thumbRule.totalRate = parseFloat((thumbRule.totalRate * config.get(Constants.SQUARE_METER)).toFixed(2));
            }
            thumbRule.totalBudgetedCost = totalRates[0].totalAmount;
            thumbRule.thumbRuleReports = thumbRuleReports;
            var totalEstimatedRates = alasql('SELECT SUM(total) AS totalAmount, SUM(rate) AS totalRate FROM ?', [estimatedReports]);
            estimate.totalRate = totalEstimatedRates[0].totalRate;
            if (rateUnit === Constants.SQUREMETER_UNIT) {
                estimate.totalRate = parseFloat((estimate.totalRate * config.get(Constants.SQUARE_METER)).toFixed(2));
            }
            estimate.totalEstimatedCost = totalEstimatedRates[0].totalAmount;
            estimate.estimatedCosts = estimatedReports;
            buildingReport.thumbRule = thumbRule;
            buildingReport.estimate = estimate;
            report.push(buildingReport);
        }
    };
    ReportService.prototype.getThumbRuleAndEstimatedReport = function (building, buildingReport, thumbRuleReports, estimatedReports, rateUnit) {
        for (var _i = 0, _a = building.costHeads; _i < _a.length; _i++) {
            var costHead = _a[_i];
            if (costHead.active) {
                var thumbRuleReport = new ThumbRuleReport();
                thumbRuleReport.name = costHead.name;
                thumbRuleReport.rateAnalysisId = costHead.rateAnalysisId;
                thumbRuleReport.amount = costHead.budgetedCostAmount;
                thumbRuleReport.costHeadActive = costHead.active;
                thumbRuleReport.rate = parseFloat((costHead.budgetedCostAmount / buildingReport.area).toFixed(2));
                if (rateUnit === Constants.SQUREMETER_UNIT) {
                    thumbRuleReport.rate = parseFloat((thumbRuleReport.rate * config.get(Constants.SQUARE_METER)).toFixed(2));
                }
                thumbRuleReports.push(thumbRuleReport);
                var estimateReport = new EstimateReport();
                estimateReport.name = costHead.name;
                estimateReport.rateAnalysisId = costHead.rateAnalysisId;
                var costHeadCategories = costHead.categories;
                for (var _b = 0, costHeadCategories_1 = costHeadCategories; _b < costHeadCategories_1.length; _b++) {
                    var category = costHeadCategories_1[_b];
                    var workItemList = category.workItems;
                    if (workItemList.length !== 0) {
                        for (var _c = 0, workItemList_1 = workItemList; _c < workItemList_1.length; _c++) {
                            var workItem = workItemList_1[_c];
                            if (workItem.quantity.total !== null && workItem.rate.total !== null
                                && workItem.quantity.total !== 0 && workItem.rate.total !== 0) {
                                estimateReport.total = parseFloat((workItem.quantity.total * workItem.rate.total + estimateReport.total).toFixed(2));
                                estimateReport.rate = parseFloat((estimateReport.total / buildingReport.area).toFixed(2));
                            }
                        }
                    }
                }
                if (rateUnit === Constants.SQUREMETER_UNIT) {
                    estimateReport.rate = parseFloat((estimateReport.rate * config.get(Constants.SQUARE_METER)).toFixed(2));
                }
                estimatedReports.push(estimateReport);
            }
        }
    };
    ReportService.prototype.generateReportForProjectCostHeads = function (reportType, projectCostHeads, totalArea, areaType, rateUnit, report) {
        var projectCostHeadArray = projectCostHeads;
        var projectReport = new BuildingReport;
        for (var projectCostHeadIndex in projectCostHeadArray) {
            var thumbRule = new ThumbRule();
            var estimate = new Estimate();
            if (projectCostHeadArray[projectCostHeadIndex].active) {
                var thumbRuleReport = new ThumbRuleReport();
                var estimateReport = new EstimateReport();
                estimateReport.name = projectCostHeadArray[projectCostHeadIndex].name;
                estimateReport.rateAnalysisId = projectCostHeadArray[projectCostHeadIndex].rateAnalysisId;
                var categoryArray = projectCostHeadArray[projectCostHeadIndex].categories;
                for (var categoryIndex in categoryArray) {
                    if (categoryArray[categoryIndex].active) {
                        var workItemArray = categoryArray[categoryIndex].workItems;
                        if (workItemArray.length !== 0) {
                            for (var workItemIndex in workItemArray) {
                                if (workItemArray[workItemIndex].active) {
                                    if (workItemArray[workItemIndex].quantity.total !== null && workItemArray[workItemIndex].rate.total !== null
                                        && workItemArray[workItemIndex].quantity.total !== 0 && workItemArray[workItemIndex].rate.total !== 0) {
                                        estimateReport.total = parseFloat((workItemArray[workItemIndex].quantity.total *
                                            workItemArray[workItemIndex].rate.total + estimateReport.total).toFixed(2));
                                        estimateReport.rate = parseFloat((estimateReport.total / totalArea).toFixed(2));
                                    }
                                }
                            }
                        }
                    }
                }
                estimate.totalEstimatedCost = parseFloat((estimateReport.total + estimate.totalEstimatedCost).toFixed(2));
                estimate.totalRate = parseFloat((estimate.totalRate + estimateReport.rate).toFixed(2));
                estimate.estimatedCosts.push(estimateReport);
                thumbRuleReport.name = projectCostHeadArray[projectCostHeadIndex].name;
                thumbRuleReport.rateAnalysisId = projectCostHeadArray[projectCostHeadIndex].rateAnalysisId;
                thumbRuleReport.amount = parseFloat((projectCostHeadArray[projectCostHeadIndex].budgetedCostAmount).toFixed(2));
                if (rateUnit === Constants.SQUREFEET_UNIT) {
                    thumbRuleReport.rate = parseFloat((thumbRuleReport.amount / totalArea).toFixed(2));
                }
                else {
                    thumbRule.area = thumbRuleReport.amount * config.get(Constants.SQUARE_METER);
                    thumbRuleReport.rate = parseFloat((thumbRuleReport.amount / thumbRule.area).toFixed(2));
                }
                thumbRule.totalRate = parseFloat((thumbRule.totalRate + thumbRuleReport.rate).toFixed(2));
                thumbRule.totalBudgetedCost = parseFloat((thumbRule.totalBudgetedCost + thumbRuleReport.amount).toFixed(2));
                thumbRule.thumbRuleReports.push(thumbRuleReport);
                projectReport.thumbRule = thumbRule;
                projectReport.estimate = estimate;
            }
        }
        report.push(projectReport);
    };
    ReportService.prototype.getCostHeads = function (url, user, callback) {
        var _this = this;
        logger.info('Report Service, getCostHeads has been hit');
        this.rateAnalysisService.getCostHeads(url, user, function (error, result) {
            if (error) {
                console.log('error : ' + JSON.stringify(error));
                callback(error, null);
            }
            else {
                callback(null, { data: result, access_token: _this.authInterceptor.issueTokenWithUid(user) });
            }
        });
    };
    ReportService.prototype.getWorkItems = function (url, user, callback) {
        var _this = this;
        logger.info('Report Service, getWorkItems has been hit');
        this.rateAnalysisService.getWorkItems(url, user, function (error, result) {
            if (error) {
                console.log('error : ' + JSON.stringify(error));
                callback(error, null);
            }
            else {
                callback(null, { data: result, access_token: _this.authInterceptor.issueTokenWithUid(user) });
            }
        });
    };
    return ReportService;
}());
Object.seal(ReportService);
module.exports = ReportService;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC9hcHBsaWNhdGlvblByb2plY3Qvc2VydmljZXMvUmVwb3J0U2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsOEVBQWlGO0FBQ2pGLGdGQUFtRjtBQUNuRixvRUFBdUU7QUFDdkUsa0VBQXFFO0FBR3JFLG1GQUFzRjtBQUN0RixxRkFBd0Y7QUFDeEYsOEVBQWlGO0FBRWpGLG1GQUFzRjtBQUN0RixpRkFBb0Y7QUFDcEYsMEVBQTZFO0FBQzdFLHdFQUEyRTtBQUMzRSwyREFBOEQ7QUFFOUQsK0JBQWtDO0FBQ2xDLCtDQUFrRDtBQUNsRCxJQUFJLE1BQU0sR0FBRyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUM7QUFDL0IsSUFBSSxNQUFNLEdBQUcsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDO0FBQy9CLElBQUksTUFBTSxHQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztBQUU5QztJQVNFO1FBQ0UsSUFBSSxDQUFDLGlCQUFpQixHQUFHLElBQUksaUJBQWlCLEVBQUUsQ0FBQztRQUNqRCxJQUFJLENBQUMsa0JBQWtCLEdBQUcsSUFBSSxrQkFBa0IsRUFBRSxDQUFDO1FBQ25ELElBQUksQ0FBQyxRQUFRLEdBQUcsWUFBWSxDQUFDLFFBQVEsQ0FBQztRQUN0QyxJQUFJLENBQUMsZUFBZSxHQUFHLElBQUksZUFBZSxFQUFFLENBQUM7UUFDN0MsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLFdBQVcsRUFBRSxDQUFDO1FBQ3JDLElBQUksQ0FBQyxtQkFBbUIsR0FBRyxJQUFJLG1CQUFtQixFQUFFLENBQUM7SUFDdkQsQ0FBQztJQUVELGlDQUFTLEdBQVQsVUFBVyxTQUFlLEVBQUUsVUFBbUIsRUFBRSxRQUFpQixFQUFFLFFBQWlCLEVBQUcsSUFBVSxFQUN2RixRQUEyQztRQUR0RCxpQkFnQ0M7UUE3QkMsTUFBTSxDQUFDLElBQUksQ0FBQyx3Q0FBd0MsQ0FBQyxDQUFDO1FBQ3RELElBQUksS0FBSyxHQUFHLEVB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WUFDN0YsQ0FBQztRQUNILENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVELG9DQUFZLEdBQVosVUFBYyxHQUFXLEVBQUcsSUFBVSxFQUFFLFFBQTJDO1FBQW5GLGlCQVVDO1FBVEMsTUFBTSxDQUFDLElBQUksQ0FBQywyQ0FBMkMsQ0FBQyxDQUFDO1FBQ3pELElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxZQUFZLENBQUUsR0FBRyxFQUFFLElBQUksRUFBQyxVQUFDLEtBQUssRUFBRSxNQUFNO1lBQzdELEVBQUUsQ0FBQSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7Z0JBQ1QsT0FBTyxDQUFDLEdBQUcsQ0FBQyxVQUFVLEdBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO2dCQUM5QyxRQUFRLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxDQUFDO1lBQ3hCLENBQUM7WUFBQyxJQUFJLENBQUMsQ0FBQztnQkFDTixRQUFRLENBQUMsSUFBSSxFQUFDLEVBQUUsSUFBSSxFQUFFLE1BQU0sRUFBRSxZQUFZLEVBQUUsS0FBSSxDQUFDLGVBQWUsQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsRUFBQyxDQUFDLENBQUM7WUFDN0YsQ0FBQztRQUNILENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVILG9CQUFDO0FBQUQsQ0F0T0EsQUFzT0MsSUFBQTtBQUVELE1BQU0sQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLENBQUM7QUFDM0IsaUJBQVMsYUFBYSxDQUFDIiwiZmlsZSI6ImFwcC9hcHBsaWNhdGlvblByb2plY3Qvc2VydmljZXMvUmVwb3J0U2VydmljZS5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBQcm9qZWN0UmVwb3NpdG9yeSA9IHJlcXVpcmUoJy4uL2RhdGFhY2Nlc3MvcmVwb3NpdG9yeS9Qcm9qZWN0UmVwb3NpdG9yeScpO1xyXG5pbXBvcnQgQnVpbGRpbmdSZXBvc2l0b3J5ID0gcmVxdWlyZSgnLi4vZGF0YWFjY2Vzcy9yZXBvc2l0b3J5L0J1aWxkaW5nUmVwb3NpdG9yeScpO1xyXG5pbXBvcnQgVXNlclNlcnZpY2UgPSByZXF1aXJlKCcuLy4uLy4uL2ZyYW1ld29yay9zZXJ2aWNlcy9Vc2VyU2VydmljZScpO1xyXG5pbXBvcnQgUHJvamVjdEFzc2V0ID0gcmVxdWlyZSgnLi4vLi4vZnJhbWV3b3JrL3NoYXJlZC9wcm9qZWN0YXNzZXQnKTtcclxuaW1wb3J0IFVzZXIgPSByZXF1aXJlKCcuLi8uLi9mcmFtZXdvcmsvZGF0YWFjY2Vzcy9tb25nb29zZS91c2VyJyk7XHJcbmltcG9ydCBCdWlsZGluZyA9IHJlcXVpcmUoJy4uL2RhdGFhY2Nlc3MvbW9uZ29vc2UvQnVpbGRpbmcnKTtcclxuaW1wb3J0IEJ1aWxkaW5nUmVwb3J0ID0gcmVxdWlyZSgnLi4vZGF0YWFjY2Vzcy9tb2RlbC9wcm9qZWN0L3JlcG9ydHMvQnVpbGRpbmdSZXBvcnQnKTtcclxuaW1wb3J0IFRodW1iUnVsZVJlcG9ydCA9IHJlcXVpcmUoJy4uL2RhdGFhY2Nlc3MvbW9kZWwvcHJvamVjdC9yZXBvcnRzL1RodW1iUnVsZVJlcG9ydCcpO1xyXG5pbXBvcnQgQXV0aEludGVyY2VwdG9yID0gcmVxdWlyZSgnLi4vLi4vZnJhbWV3b3JrL2ludGVyY2VwdG9yL2F1dGguaW50ZXJjZXB0b3InKTtcclxuaW1wb3J0IENvc3RIZWFkID0gcmVxdWlyZSgnLi4vZGF0YWFjY2Vzcy9tb25nb29zZS9Db3N0SGVhZCcpO1xyXG5pbXBvcnQgRXN0aW1hdGVSZXBvcnQgPSByZXF1aXJlKCcuLi9kYXRhYWNjZXNzL21vZGVsL3Byb2plY3QvcmVwb3J0cy9Fc3RpbWF0ZVJlcG9ydCcpO1xyXG5pbXBvcnQgUHJvamVjdFJlcG9ydCA9IHJlcXVpcmUoJy4uL2RhdGFhY2Nlc3MvbW9kZWwvcHJvamVjdC9yZXBvcnRzL1Byb2plY3RSZXBvcnQnKTtcclxuaW1wb3J0IFRodW1iUnVsZSA9IHJlcXVpcmUoJy4uL2RhdGFhY2Nlc3MvbW9kZWwvcHJvamVjdC9idWlsZGluZy9UaHVtYlJ1bGUnKTtcclxuaW1wb3J0IEVzdGltYXRlID0gcmVxdWlyZSgnLi4vZGF0YWFjY2Vzcy9tb2RlbC9wcm9qZWN0L2J1aWxkaW5nL0VzdGltYXRlJyk7XHJcbmltcG9ydCBSYXRlQW5hbHlzaXNTZXJ2aWNlID0gcmVxdWlyZSgnLi9SYXRlQW5hbHlzaXNTZXJ2aWNlJyk7XHJcbmltcG9ydCBDYXRlZ29yeSA9IHJlcXVpcmUoJy4uL2RhdGFhY2Nlc3MvbW9kZWwvcHJvamVjdC9idWlsZGluZy9DYXRlZ29yeScpO1xyXG5pbXBvcnQgYWxhc3FsID0gcmVxdWlyZSgnYWxhc3FsJyk7XHJcbmltcG9ydCBDb25zdGFudHMgPSByZXF1aXJlKCcuLi9zaGFyZWQvY29uc3RhbnRzJyk7XHJcbmxldCBjb25maWcgPSByZXF1aXJlKCdjb25maWcnKTtcclxudmFyIGxvZzRqcyA9IHJlcXVpcmUoJ2xvZzRqcycpO1xyXG52YXIgbG9nZ2VyPWxvZzRqcy5nZXRMb2dnZXIoJ1JlcG9ydCBTZXJ2aWNlJyk7XHJcblxyXG5jbGFzcyBSZXBvcnRTZXJ2aWNlIHtcclxuICBBUFBfTkFNRTogc3RyaW5nO1xyXG4gIGNvbXBhbnlfbmFtZTogc3RyaW5nO1xyXG4gIHByaXZhdGUgcHJvamVjdFJlcG9zaXRvcnk6IFByb2plY3RSZXBvc2l0b3J5O1xyXG4gIHByaXZhdGUgYnVpbGRpbmdSZXBvc2l0b3J5OiBCdWlsZGluZ1JlcG9zaXRvcnk7XHJcbiAgcHJpdmF0ZSBhdXRoSW50ZXJjZXB0b3I6IEF1dGhJbnRlcmNlcHRvcjtcclxuICBwcml2YXRlIHVzZXJTZXJ2aWNlIDogVXNlclNlcnZpY2U7XHJcbiAgcHJpdmF0ZSByYXRlQW5hbHlzaXNTZXJ2aWNlIDogUmF0ZUFuYWx5c2lzU2VydmljZTtcclxuXHJcbiAgY29uc3RydWN0b3IoKSB7XHJcbiAgICB0aGlzLnByb2plY3RSZXBvc2l0b3J5ID0gbmV3IFByb2plY3RSZXBvc2l0b3J5KCk7XHJcbiAgICB0aGlzLmJ1aWxkaW5nUmVwb3NpdG9yeSA9IG5ldyBCdWlsZGluZ1JlcG9zaXRvcnkoKTtcclxuICAgIHRoaXMuQVBQX05BTUUgPSBQcm9qZWN0QXNzZXQuQVBQX05BTUU7XHJcbiAgICB0aGlzLmF1dGhJbnRlcmNlcHRvciA9IG5ldyBBdXRoSW50ZXJjZXB0b3IoKTtcclxuICAgIHRoaXMudXNlclNlcnZpY2UgPSBuZXcgVXNlclNlcnZpY2UoKTtcclxuICAgIHRoaXMucmF0ZUFuYWx5c2lzU2VydmljZSA9IG5ldyBSYXRlQW5hbHlzaXNTZXJ2aWNlKCk7XHJcbiAgfVxyXG5cclxuICBnZXRSZXBvcnQoIHByb2plY3RJZCA6IGFueSwgcmVwb3J0VHlwZSA6IHN0cmluZywgcmF0ZVVuaXQgOiBzdHJpbmcsIGFyZWFUeXBlIDogc3RyaW5nLOKAguKAgnVzZXI6IFVzZXIsXHJcbiAgICAgICAgICAgICBjYWxsYmFjazogKGVycm9yOiBhbnksIHJlc3VsdDogYW55KSA9PiB2b2lkKSB7XHJcblxyXG4gICAgbG9nZ2VyLmluZm8oJ1JlcG9ydCBTZXJ2aWNlLCBnZXRSZXBvcnQgaGFzIGJlZW4gaGl0Jyk7XHJcbiAgICBsZXQgcXVlcnkgPSB7IF9pZDogcHJvamVjdElkfTtcclxuICAgIGxldCBwb3B1bGF0ZSA9IHtwYXRoIDogJ2J1aWxkaW5ncyd9O1xyXG4gICAgdGhpcy5wcm9qZWN0UmVwb3NpdG9yeS5maW5kQW5kUG9wdWxhdGUocXVlcnksIHBvcHVsYXRlLCAoZXJyb3IsIHJlc3VsdCkgPT4ge1xyXG4gICAgICBsb2dnZXIuaW5mbygnUmVwb3J0IFNlcnZpY2UsIGZpbmRBbmRQb3B1bGF0ZSBoYXMgYmVlbiBoaXQnKTtcclxuICAgICAgaWYoZXJyb3IpIHtcclxuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgbGV0IGJ1aWxkaW5ncyA9IHJlc3VsdFswXS5idWlsZGluZ3M7XHJcbiAgICAgICAgaWYgKGFyZWFUeXBlID09PSBDb25zdGFudHMuU0xBQl9BUkVBKSB7XHJcbiAgICAgICAgICAgIHZhciB0eXBlT2ZBcmVhID0gQ29uc3RhbnRzLlRPVEFMX1NMQUJfQVJFQTtcclxuICAgICAgICAgIH0gZWxzZSBpZiAoYXJlYVR5cGUgPT09IENvbnN0YW50cy5TQUxFQUJMRV9BUkVBKSB7XHJcbiAgICAgICAgICAgIHR5cGVPZkFyZWEgPSBDb25zdGFudHMuVE9UQUxfU0FMRUFCTEVfQVJFQTtcclxuICAgICAgICAgIH0gZWxzZSBpZiAoYXJlYVR5cGUgPT09IENvbnN0YW50cy5DQVJQRVRfQVJFQSkge1xyXG4gICAgICAgICAgICB0eXBlT2ZBcmVhID0gQ29uc3RhbnRzLlRPVEFMX0NBUlBFVF9BUkVBO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIGxldCB0b3RhbEFyZWEgPSBhbGFzcWwoJ1ZBTFVFIE9GIFNFTEVDVCBTVU0oJyt0eXBlT2ZBcmVhKycpIEZST00gPycsW2J1aWxkaW5nc10pO1xyXG4gICAgICAgIGxldCBwcm9qZWN0Q29zdEhlYWRzID0gcmVzdWx0WzBdLnByb2plY3RDb3N0SGVhZHM7XHJcbiAgICAgICAgbGV0IHByb2plY3RSZXBvcnQgOiBQcm9qZWN0UmVwb3J0ID0gbmV3IFByb2plY3RSZXBvcnQoKTtcclxuICAgICAgICBsZXQgYnVpbGRpbmdSZXBvcnQgOiBBcnJheTxCdWlsZGluZ1JlcG9ydD4gPSBuZXcgQXJyYXk8QnVpbGRpbmdSZXBvcnQ+KCk7XHJcbiAgICAgICAgdGhpcy5nZW5lcmF0ZVJlcG9ydEJ5Q29zdEhlYWRzKCAnYnVpbGRpbmdSZXBvcnQnLCBidWlsZGluZ3MsIGFyZWFUeXBlLCByYXRlVW5pdCwgYnVpbGRpbmdSZXBvcnQpO1xyXG4gICAgICAgIHByb2plY3RSZXBvcnQuYnVpbGRpbmdzID0gYnVpbGRpbmdSZXBvcnQ7XHJcbiAgICAgICAgbGV0IGNvbW1vbkFtZW5pdGllc1JlcG9ydCA6IEFycmF5PEJ1aWxkaW5nUmVwb3J0PiA9IG5ldyBBcnJheTxCdWlsZGluZ1JlcG9ydD4oKTtcclxuICAgICAgICB0aGlzLmdlbmVyYXRlUmVwb3J0Rm9yUHJvamVjdENvc3RIZWFkcygnY29tbW9uQW1lbml0aWVzUmVwb3J0Jyxwcm9qZWN0Q29zdEhlYWRzICx0b3RhbEFyZWEsXHJcbiAgICAgICAgICBhcmVhVHlwZSwgcmF0ZVVuaXQsIGNvbW1vbkFtZW5pdGllc1JlcG9ydCk7XHJcbiAgICAgICAgcHJvamVjdFJlcG9ydC5jb21tb25BbWVuaXRpZXMgPSBjb21tb25BbWVuaXRpZXNSZXBvcnQ7XHJcbiAgICAgICAgY2FsbGJhY2sobnVsbCx7IGRhdGE6IHByb2plY3RSZXBvcnQsIGFjY2Vzc190b2tlbjogdGhpcy5hdXRoSW50ZXJjZXB0b3IuaXNzdWVUb2tlbldpdGhVaWQodXNlcil9KTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBnZW5lcmF0ZVJlcG9ydEJ5Q29zdEhlYWRzKCByZXBvcnRUeXBlIDogc3RyaW5nLCBidWlsZGluZ3M6ICBBcnJheTxCdWlsZGluZz4gLCBhcmVhVHlwZTogc3RyaW5nLCByYXRlVW5pdDogc3RyaW5nLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcG9ydDogQXJyYXk8QnVpbGRpbmdSZXBvcnQ+KSB7XHJcbiAgICBmb3IgKGxldCBidWlsZGluZyBvZiBidWlsZGluZ3MpIHtcclxuICAgICAgbGV0IGJ1aWxkaW5nQXJlYVR5cGU6IHN0cmluZztcclxuICAgICAgbGV0IHJlcG9ydFVuaXRUeXBlOiBzdHJpbmc7XHJcblxyXG4gICAgICBpZihhcmVhVHlwZSA9PT0gJ3NsYWJBcmVhJykge1xyXG4gICAgICAgIGJ1aWxkaW5nQXJlYVR5cGUgPSAndG90YWxTbGFiQXJlYSc7XHJcbiAgICAgIH0gZWxzZSBpZihhcmVhVHlwZSA9PT0gJ3NhbGVhYmxlQXJlYScpIHtcclxuICAgICAgICBidWlsZGluZ0FyZWFUeXBlID0gJ3RvdGFsU2FsZWFibGVBcmVhT2ZVbml0JztcclxuICAgICAgfSBlbHNlIGlmKGFyZWFUeXBlID09PSAnY2FycGV0QXJlYScpIHtcclxuICAgICAgICBidWlsZGluZ0FyZWFUeXBlID0gJ3RvdGFsQ2FycGV0QXJlYU9mVW5pdCc7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGxldCBidWlsZGluZ1JlcG9ydCA9IG5ldyBCdWlsZGluZ1JlcG9ydDtcclxuICAgICAgYnVpbGRpbmdSZXBvcnQubmFtZSA9IGJ1aWxkaW5nLm5hbWU7XHJcbiAgICAgIGJ1aWxkaW5nUmVwb3J0Ll9pZCA9IGJ1aWxkaW5nLl9pZDtcclxuICAgICAgYnVpbGRpbmdSZXBvcnQuYXJlYSA9IGJ1aWxkaW5nW2J1aWxkaW5nQXJlYVR5cGVdO1xyXG5cclxuICAgICAgbGV0IHRodW1iUnVsZSAgPSBuZXcgVGh1bWJSdWxlKCk7XHJcbiAgICAgIGxldCBlc3RpbWF0ZSAgPSBuZXcgRXN0aW1hdGUoKTtcclxuICAgICAgbGV0IHRodW1iUnVsZVJlcG9ydHMgPSBuZXcgQXJyYXk8VGh1bWJSdWxlUmVwb3J0PigpO1xyXG4gICAgICBsZXQgZXN0aW1hdGVkUmVwb3J0cyA9IG5ldyBBcnJheTxFc3RpbWF0ZVJlcG9ydD4oKTtcclxuXHJcblxyXG4gICAgICB0aGlzLmdldFRodW1iUnVsZUFuZEVzdGltYXRlZFJlcG9ydChidWlsZGluZywgYnVpbGRpbmdSZXBvcnQsIHRodW1iUnVsZVJlcG9ydHMsIGVzdGltYXRlZFJlcG9ydHMsIHJhdGVVbml0KTtcclxuXHJcbiAgICAgIGxldCB0b3RhbFJhdGVzID0gYWxhc3FsKCdTRUxFQ1QgU1VNKGFtb3VudCkgQVMgdG90YWxBbW91bnQsIFNVTShyYXRlKSBBUyB0b3RhbFJhdGUgRlJPTSA/JyxbdGh1bWJSdWxlUmVwb3J0c10pO1xyXG4gICAgICB0aHVtYlJ1bGUudG90YWxSYXRlID0gdG90YWxSYXRlc1swXS50b3RhbFJhdGU7XHJcbiAgICAgIGlmKHJhdGVVbml0ID09PSBDb25zdGFudHMuU1FVUkVNRVRFUl9VTklUKSB7XHJcbiAgICAgICAgdGh1bWJSdWxlLnRvdGFsUmF0ZSA9ICBwYXJzZUZsb2F0KCh0aHVtYlJ1bGUudG90YWxSYXRlICogY29uZmlnLmdldChDb25zdGFudHMuU1FVQVJFX01FVEVSKSkudG9GaXhlZCgyKSk7XHJcbiAgICAgIH1cclxuICAgICAgdGh1bWJSdWxlLnRvdGFsQnVkZ2V0ZWRDb3N0ID0gdG90YWxSYXRlc1swXS50b3RhbEFtb3VudDtcclxuICAgICAgdGh1bWJSdWxlLnRodW1iUnVsZVJlcG9ydHMgPSB0aHVtYlJ1bGVSZXBvcnRzO1xyXG5cclxuICAgICAgbGV0IHRvdGFsRXN0aW1hdGVkUmF0ZXMgPSBhbGFzcWwoJ1NFTEVDVCBTVU0odG90YWwpIEFTIHRvdGFsQW1vdW50LCBTVU0ocmF0ZSkgQVMgdG90YWxSYXRlIEZST00gPycsW2VzdGltYXRlZFJlcG9ydHNdKTtcclxuICAgICAgZXN0aW1hdGUudG90YWxSYXRlID0gdG90YWxFc3RpbWF0ZWRSYXRlc1swXS50b3RhbFJhdGU7XHJcbiAgICAgIGlmKHJhdGVVbml0ID09PSBDb25zdGFudHMuU1FVUkVNRVRFUl9VTklUKSB7XHJcbiAgICAgICAgZXN0aW1hdGUudG90YWxSYXRlID0gIHBhcnNlRmxvYXQoKGVzdGltYXRlLnRvdGFsUmF0ZSAqIGNvbmZpZy5nZXQoQ29uc3RhbnRzLlNRVUFSRV9NRVRFUikpLnRvRml4ZWQoMikpO1xyXG4gICAgICB9XHJcbiAgICAgIGVzdGltYXRlLnRvdGFsRXN0aW1hdGVkQ29zdCA9IHRvdGFsRXN0aW1hdGVkUmF0ZXNbMF0udG90YWxBbW91bnQ7XHJcbiAgICAgIGVzdGltYXRlLmVzdGltYXRlZENvc3RzID0gZXN0aW1hdGVkUmVwb3J0cztcclxuXHJcbiAgICAgIGJ1aWxkaW5nUmVwb3J0LnRodW1iUnVsZSA9IHRodW1iUnVsZTtcclxuICAgICAgYnVpbGRpbmdSZXBvcnQuZXN0aW1hdGUgPSBlc3RpbWF0ZTtcclxuICAgICAgcmVwb3J0LnB1c2goYnVpbGRpbmdSZXBvcnQpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcblxyXG4gIGdldFRodW1iUnVsZUFuZEVzdGltYXRlZFJlcG9ydChidWlsZGluZyA6QnVpbGRpbmcsIGJ1aWxkaW5nUmVwb3J0OiBCdWlsZGluZ1JlcG9ydCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGh1bWJSdWxlUmVwb3J0czogVGh1bWJSdWxlUmVwb3J0W10sIGVzdGltYXRlZFJlcG9ydHM6IEVzdGltYXRlUmVwb3J0W10sIHJhdGVVbml0OnN0cmluZykge1xyXG5cclxuICAgIGZvciAobGV0IGNvc3RIZWFkIG9mIGJ1aWxkaW5nLmNvc3RIZWFkcykge1xyXG5cclxuICAgICAgaWYoY29zdEhlYWQuYWN0aXZlKSB7XHJcbiAgICAgICAgLy9UaHVtYlJ1bGUgUmVwb3J0XHJcbiAgICAgICAgbGV0IHRodW1iUnVsZVJlcG9ydCA9IG5ldyBUaHVtYlJ1bGVSZXBvcnQoKTtcclxuICAgICAgICB0aHVtYlJ1bGVSZXBvcnQubmFtZSA9IGNvc3RIZWFkLm5hbWU7XHJcbiAgICAgICAgdGh1bWJSdWxlUmVwb3J0LnJhdGVBbmFseXNpc0lkID0gY29zdEhlYWQucmF0ZUFuYWx5c2lzSWQ7XHJcbiAgICAgICAgdGh1bWJSdWxlUmVwb3J0LmFtb3VudCA9IGNvc3RIZWFkLmJ1ZGdldGVkQ29zdEFtb3VudDtcclxuICAgICAgICB0aHVtYlJ1bGVSZXBvcnQuY29zdEhlYWRBY3RpdmUgPSBjb3N0SGVhZC5hY3RpdmU7XHJcbiAgICAgICAgdGh1bWJSdWxlUmVwb3J0LnJhdGUgPSBwYXJzZUZsb2F0KChjb3N0SGVhZC5idWRnZXRlZENvc3RBbW91bnQgLyBidWlsZGluZ1JlcG9ydC5hcmVhKS50b0ZpeGVkKDIpKTtcclxuICAgICAgICBpZihyYXRlVW5pdCA9PT0gQ29uc3RhbnRzLlNRVVJFTUVURVJfVU5JVCkge1xyXG4gICAgICAgICAgdGh1bWJSdWxlUmVwb3J0LnJhdGUgPSBwYXJzZUZsb2F0KCh0aHVtYlJ1bGVSZXBvcnQucmF0ZSAqIGNvbmZpZy5nZXQoQ29uc3RhbnRzLlNRVUFSRV9NRVRFUikpLnRvRml4ZWQoMikpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aHVtYlJ1bGVSZXBvcnRzLnB1c2godGh1bWJSdWxlUmVwb3J0KTtcclxuXHJcbiAgICAgICAgLy9Fc3RpbWF0ZWQgY29zdCBSZXBvcnRcclxuICAgICAgICBsZXQgZXN0aW1hdGVSZXBvcnQgPSBuZXcgRXN0aW1hdGVSZXBvcnQoKTtcclxuICAgICAgICBlc3RpbWF0ZVJlcG9ydC5uYW1lID0gY29zdEhlYWQubmFtZTtcclxuICAgICAgICBlc3RpbWF0ZVJlcG9ydC5yYXRlQW5hbHlzaXNJZCA9IGNvc3RIZWFkLnJhdGVBbmFseXNpc0lkO1xyXG5cclxuICAgICAgICBsZXQgY29zdEhlYWRDYXRlZ29yaWVzOiBBcnJheTxDYXRlZ29yeT4gPSBjb3N0SGVhZC5jYXRlZ29yaWVzO1xyXG4gICAgICAgIGZvciAobGV0IGNhdGVnb3J5IG9mIGNvc3RIZWFkQ2F0ZWdvcmllcykge1xyXG4gICAgICAgICAgbGV0IHdvcmtJdGVtTGlzdCA9IGNhdGVnb3J5LndvcmtJdGVtcztcclxuICAgICAgICAgIGlmICh3b3JrSXRlbUxpc3QubGVuZ3RoICE9PSAwKSB7XHJcbiAgICAgICAgICAgIGZvciAobGV0IHdvcmtJdGVtIG9mIHdvcmtJdGVtTGlzdCkge1xyXG4gICAgICAgICAgICAgIGlmICh3b3JrSXRlbS5xdWFudGl0eS50b3RhbCAhPT0gbnVsbCAmJiB3b3JrSXRlbS5yYXRlLnRvdGFsICE9PSBudWxsXHJcbiAgICAgICAgICAgICAgICAmJiB3b3JrSXRlbS5xdWFudGl0eS50b3RhbCAhPT0gMCAmJiB3b3JrSXRlbS5yYXRlLnRvdGFsICE9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICBlc3RpbWF0ZVJlcG9ydC50b3RhbCA9IHBhcnNlRmxvYXQoKHdvcmtJdGVtLnF1YW50aXR5LnRvdGFsICogd29ya0l0ZW0ucmF0ZS50b3RhbCArIGVzdGltYXRlUmVwb3J0LnRvdGFsKS50b0ZpeGVkKDIpKTtcclxuICAgICAgICAgICAgICAgIGVzdGltYXRlUmVwb3J0LnJhdGUgPSBwYXJzZUZsb2F0KChlc3RpbWF0ZVJlcG9ydC50b3RhbCAvIGJ1aWxkaW5nUmVwb3J0LmFyZWEpLnRvRml4ZWQoMikpO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZihyYXRlVW5pdCA9PT0gQ29uc3RhbnRzLlNRVVJFTUVURVJfVU5JVCkge1xyXG4gICAgICAgICAgZXN0aW1hdGVSZXBvcnQucmF0ZSA9IHBhcnNlRmxvYXQoKGVzdGltYXRlUmVwb3J0LnJhdGUgKiBjb25maWcuZ2V0KENvbnN0YW50cy5TUVVBUkVfTUVURVIpKS50b0ZpeGVkKDIpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZXN0aW1hdGVkUmVwb3J0cy5wdXNoKGVzdGltYXRlUmVwb3J0KTtcclxuICAgICAgfVxyXG4gICAgICB9XHJcbiAgfVxyXG5cclxuICBnZW5lcmF0ZVJlcG9ydEZvclByb2plY3RDb3N0SGVhZHMoIHJlcG9ydFR5cGUgOiBzdHJpbmcsIHByb2plY3RDb3N0SGVhZHM6ICBBcnJheTxDb3N0SGVhZD4sIHRvdGFsQXJlYTogbnVtYmVyLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZWFUeXBlOiBzdHJpbmcsIHJhdGVVbml0OiBzdHJpbmcsIHJlcG9ydDogQXJyYXk8QnVpbGRpbmdSZXBvcnQ+KSB7XHJcblxyXG4gICAgICBsZXQgcHJvamVjdENvc3RIZWFkQXJyYXk6IEFycmF5PENvc3RIZWFkPiA9IHByb2plY3RDb3N0SGVhZHM7XHJcbiAgICAgIGxldCBwcm9qZWN0UmVwb3J0ID0gbmV3IEJ1aWxkaW5nUmVwb3J0O1xyXG4gICAgICAgZm9yIChsZXQgcHJvamVjdENvc3RIZWFkSW5kZXggaW4gcHJvamVjdENvc3RIZWFkQXJyYXkpIHtcclxuXHJcbiAgICAgICAgIGxldCB0aHVtYlJ1bGU6IFRodW1iUnVsZSA9IG5ldyBUaHVtYlJ1bGUoKTtcclxuICAgICAgICAgbGV0IGVzdGltYXRlIDogRXN0aW1hdGUgPSBuZXcgRXN0aW1hdGUoKTtcclxuXHJcbiAgICAgICAgIGlmIChwcm9qZWN0Q29zdEhlYWRBcnJheVtwcm9qZWN0Q29zdEhlYWRJbmRleF0uYWN0aXZlKSB7XHJcblxyXG4gICAgICAgICAgbGV0IHRodW1iUnVsZVJlcG9ydDogVGh1bWJSdWxlUmVwb3J0ID0gbmV3IFRodW1iUnVsZVJlcG9ydCgpO1xyXG4gICAgICAgICAgbGV0IGVzdGltYXRlUmVwb3J0OiBFc3RpbWF0ZVJlcG9ydCA9IG5ldyBFc3RpbWF0ZVJlcG9ydCgpO1xyXG5cclxuICAgICAgICAgICBlc3RpbWF0ZVJlcG9ydC5uYW1lID0gcHJvamVjdENvc3RIZWFkQXJyYXlbcHJvamVjdENvc3RIZWFkSW5kZXhdLm5hbWU7XHJcbiAgICAgICAgICAgZXN0aW1hdGVSZXBvcnQucmF0ZUFuYWx5c2lzSWQgPSBwcm9qZWN0Q29zdEhlYWRBcnJheVtwcm9qZWN0Q29zdEhlYWRJbmRleF0ucmF0ZUFuYWx5c2lzSWQ7XHJcblxyXG4gICAgICAgICAgbGV0IGNhdGVnb3J5QXJyYXkgOiBBcnJheTxDYXRlZ29yeT4gPSBwcm9qZWN0Q29zdEhlYWRBcnJheVtwcm9qZWN0Q29zdEhlYWRJbmRleF0uY2F0ZWdvcmllcztcclxuICAgICAgICAgIGZvciAobGV0IGNhdGVnb3J5SW5kZXggaW4gY2F0ZWdvcnlBcnJheSkge1xyXG4gICAgICAgICAgICBpZiAoY2F0ZWdvcnlBcnJheVtjYXRlZ29yeUluZGV4XS5hY3RpdmUpIHtcclxuICAgICAgICAgICAgICBsZXQgd29ya0l0ZW1BcnJheSA9IGNhdGVnb3J5QXJyYXlbY2F0ZWdvcnlJbmRleF0ud29ya0l0ZW1zO1xyXG4gICAgICAgICAgICAgIGlmICh3b3JrSXRlbUFycmF5Lmxlbmd0aCAhPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgd29ya0l0ZW1JbmRleCBpbiB3b3JrSXRlbUFycmF5KSB7XHJcbiAgICAgICAgICAgICAgICAgIGlmICh3b3JrSXRlbUFycmF5W3dvcmtJdGVtSW5kZXhdLmFjdGl2ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh3b3JrSXRlbUFycmF5W3dvcmtJdGVtSW5kZXhdLnF1YW50aXR5LnRvdGFsICE9PSBudWxsICYmIHdvcmtJdGVtQXJyYXlbd29ya0l0ZW1JbmRleF0ucmF0ZS50b3RhbCAhPT0gbnVsbFxyXG4gICAgICAgICAgICAgICAgICAgICAgJiYgd29ya0l0ZW1BcnJheVt3b3JrSXRlbUluZGV4XS5xdWFudGl0eS50b3RhbCAhPT0gMCAmJiB3b3JrSXRlbUFycmF5W3dvcmtJdGVtSW5kZXhdLnJhdGUudG90YWwgIT09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgIGVzdGltYXRlUmVwb3J0LnRvdGFsID0gcGFyc2VGbG9hdCgod29ya0l0ZW1BcnJheVt3b3JrSXRlbUluZGV4XS5xdWFudGl0eS50b3RhbCAqXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdvcmtJdGVtQXJyYXlbd29ya0l0ZW1JbmRleF0ucmF0ZS50b3RhbCArIGVzdGltYXRlUmVwb3J0LnRvdGFsKS50b0ZpeGVkKDIpKTtcclxuICAgICAgICAgICAgICAgICAgICAgIGVzdGltYXRlUmVwb3J0LnJhdGUgPSBwYXJzZUZsb2F0KChlc3RpbWF0ZVJlcG9ydC50b3RhbCAvIHRvdGFsQXJlYSkudG9GaXhlZCgyKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBlc3RpbWF0ZS50b3RhbEVzdGltYXRlZENvc3QgPSBwYXJzZUZsb2F0KChlc3RpbWF0ZVJlcG9ydC50b3RhbCArIGVzdGltYXRlLnRvdGFsRXN0aW1hdGVkQ29zdCkudG9GaXhlZCgyKSk7XHJcbiAgICAgICAgICBlc3RpbWF0ZS50b3RhbFJhdGUgPSBwYXJzZUZsb2F0KChlc3RpbWF0ZS50b3RhbFJhdGUgKyBlc3RpbWF0ZVJlcG9ydC5yYXRlKS50b0ZpeGVkKDIpKTtcclxuICAgICAgICAgIGVzdGltYXRlLmVzdGltYXRlZENvc3RzLnB1c2goZXN0aW1hdGVSZXBvcnQpO1xyXG5cclxuICAgICAgICAgICB0aHVtYlJ1bGVSZXBvcnQubmFtZSA9IHByb2plY3RDb3N0SGVhZEFycmF5W3Byb2plY3RDb3N0SGVhZEluZGV4XS5uYW1lO1xyXG4gICAgICAgICAgIHRodW1iUnVsZVJlcG9ydC5yYXRlQW5hbHlzaXNJZCA9IHByb2plY3RDb3N0SGVhZEFycmF5W3Byb2plY3RDb3N0SGVhZEluZGV4XS5yYXRlQW5hbHlzaXNJZDtcclxuICAgICAgICAgICB0aHVtYlJ1bGVSZXBvcnQuYW1vdW50ID0gcGFyc2VGbG9hdCgocHJvamVjdENvc3RIZWFkQXJyYXlbcHJvamVjdENvc3RIZWFkSW5kZXhdLmJ1ZGdldGVkQ29zdEFtb3VudCkudG9GaXhlZCgyKSk7XHJcblxyXG4gICAgICAgICAgICBpZiAocmF0ZVVuaXQgPT09IENvbnN0YW50cy5TUVVSRUZFRVRfVU5JVCkge1xyXG4gICAgICAgICAgICAgIHRodW1iUnVsZVJlcG9ydC5yYXRlID0gIHBhcnNlRmxvYXQoKHRodW1iUnVsZVJlcG9ydC5hbW91bnQvdG90YWxBcmVhKS50b0ZpeGVkKDIpKTtcclxuICAgICAgICAgICAgfSBlbHNlICB7XHJcbiAgICAgICAgICAgICAgdGh1bWJSdWxlLmFyZWEgPSB0aHVtYlJ1bGVSZXBvcnQuYW1vdW50ICogY29uZmlnLmdldChDb25zdGFudHMuU1FVQVJFX01FVEVSKTtcclxuICAgICAgICAgICAgICB0aHVtYlJ1bGVSZXBvcnQucmF0ZSA9IHBhcnNlRmxvYXQoKHRodW1iUnVsZVJlcG9ydC5hbW91bnQvdGh1bWJSdWxlLmFyZWEpLnRvRml4ZWQoMikpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB0aHVtYlJ1bGUudG90YWxSYXRlID0gcGFyc2VGbG9hdCgodGh1bWJSdWxlLnRvdGFsUmF0ZSArIHRodW1iUnVsZVJlcG9ydC5yYXRlKS50b0ZpeGVkKDIpKTtcclxuICAgICAgICAgIHRodW1iUnVsZS50b3RhbEJ1ZGdldGVkQ29zdCA9IHBhcnNlRmxvYXQoKHRodW1iUnVsZS50b3RhbEJ1ZGdldGVkQ29zdCArIHRodW1iUnVsZVJlcG9ydC5hbW91bnQpLnRvRml4ZWQoMikpO1xyXG4gICAgICAgICAgdGh1bWJSdWxlLnRodW1iUnVsZVJlcG9ydHMucHVzaCh0aHVtYlJ1bGVSZXBvcnQpO1xyXG4gICAgICAgICAgcHJvamVjdFJlcG9ydC50aHVtYlJ1bGUgPSB0aHVtYlJ1bGU7XHJcbiAgICAgICAgICBwcm9qZWN0UmVwb3J0LmVzdGltYXRlID0gZXN0aW1hdGU7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIHJlcG9ydC5wdXNoKHByb2plY3RSZXBvcnQpO1xyXG4gIH1cclxuXHJcbiAgZ2V0Q29zdEhlYWRzKCAgdXJsOiBzdHJpbmcgLCB1c2VyOiBVc2VyLGNhbGxiYWNrOiAoZXJyb3I6IGFueSwgcmVzdWx0OiBhbnkpID0+IHZvaWQpIHtcclxuICAgIGxvZ2dlci5pbmZvKCdSZXBvcnQgU2VydmljZSwgZ2V0Q29zdEhlYWRzIGhhcyBiZWVuIGhpdCcpO1xyXG4gICAgdGhpcy5yYXRlQW5hbHlzaXNTZXJ2aWNlLmdldENvc3RIZWFkcyggdXJsLCB1c2VyLChlcnJvciwgcmVzdWx0KSA9PiB7XHJcbiAgICAgIGlmKGVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ2Vycm9yIDogJytKU09OLnN0cmluZ2lmeShlcnJvcikpO1xyXG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBjYWxsYmFjayhudWxsLHsgZGF0YTogcmVzdWx0LCBhY2Nlc3NfdG9rZW46IHRoaXMuYXV0aEludGVyY2VwdG9yLmlzc3VlVG9rZW5XaXRoVWlkKHVzZXIpfSk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgZ2V0V29ya0l0ZW1zKCB1cmw6IHN0cmluZyAsIHVzZXI6IFVzZXIsIGNhbGxiYWNrOiAoZXJyb3I6IGFueSwgcmVzdWx0OiBhbnkpID0+IHZvaWQpIHtcclxuICAgIGxvZ2dlci5pbmZvKCdSZXBvcnQgU2VydmljZSwgZ2V0V29ya0l0ZW1zIGhhcyBiZWVuIGhpdCcpO1xyXG4gICAgdGhpcy5yYXRlQW5hbHlzaXNTZXJ2aWNlLmdldFdvcmtJdGVtcyggdXJsLCB1c2VyLChlcnJvciwgcmVzdWx0KSA9PiB7XHJcbiAgICAgIGlmKGVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ2Vycm9yIDogJytKU09OLnN0cmluZ2lmeShlcnJvcikpO1xyXG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBjYWxsYmFjayhudWxsLHsgZGF0YTogcmVzdWx0LCBhY2Nlc3NfdG9rZW46IHRoaXMuYXV0aEludGVyY2VwdG9yLmlzc3VlVG9rZW5XaXRoVWlkKHVzZXIpfSk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbn1cclxuXHJcbk9iamVjdC5zZWFsKFJlcG9ydFNlcnZpY2UpO1xyXG5leHBvcnQgPSBSZXBvcnRTZXJ2aWNlO1xyXG5cclxuIl19
